{"version":3,"sources":["ko-component-router.js"],"names":["global","factory","exports","module","require","define","amd","ko","router","this","isObjectObject","o","isObject","Object","prototype","toString","call","isArray","arr","splice","isBool","x","isPlainObject","index","isString","isFunction","isUndefined","flatMap","fn","reduce","flattened","v","concat","runMiddleware","callbacks","this$1","args","len","arguments","length","downstream","map","runner","generatorify","apply","run","Promise","$return","$error","ret","next","isThenable","then","value","bind","$await_18","$boundEx","push","sequence","$Loop_9","$iterator_fn_8","done","_fn","promisify","$await_19","$Loop_9_exit","$Loop_9_trampoline","Symbol","iterator","q","pop","_exception","isGenerator","constructor","name","count","$await_20","beforeRender","$If_13","$logicalAnd_1","afterRender","$await_23","$If_14","$logicalAnd_2","beforeDispose","$await_25","$If_15","$logicalAnd_3","afterDispose","$await_27","r","parse","str","options","res","tokens","key","path","defaultDelimiter","delimiter","PATH_REGEXP","exec","m","escaped","offset","slice","prefix","capture","group","modifier","asterisk","partial","repeat","optional","pattern","escapeGroup","escapeString","substr","compile","tokensToFunction","encodeURIComponentPretty","encodeURI","replace","c","charCodeAt","toUpperCase","encodeAsterisk","matches","Array","i","RegExp","obj","opts","data","encode","pretty","encodeURIComponent","token","segment","TypeError","isarray","JSON","stringify","j","test","attachKeys","re","keys","flags","sensitive","regexpToRegexp","groups","source","match","arrayToRegexp","parts","pathToRegexp","regexp","join","stringToRegexp","tokensToRegExp","strict","end","route","endsWithDelimiter","resolveHref","bindingCtx","_path","ref","parsePathBinding","base","isActivePath","isNavigating","ctx","pathname","split","getRouter","indexOf","isRoot","$parent","$child","$router","$parentContext","Router$1","get","unwrapParams","params","unwrapParam","p","isObservable","console","warn","unwrap","index$1","val","ctor","prot","hasOwnProperty","Context","assign","fullPath","canonicalPath","$root","_queue","_beforeNavigateCallbacks","_afterRenderCallbacks","_beforeDisposeCallbacks","_afterDisposeCallbacks","prototypeAccessors$1","$parents","$children","element","addBeforeNavigateCallback","cb","unshift","undefined","document","getElementsByClassName","depth","runBeforeNavigateCallbacks","queue","promise","flushQueue","all","runBeforeRender","appBeforeRender","appDownstream","routeBeforeRender","routeDownstream","middleware","$await_3","$await_4","$await_5","runAfterRender","$await_6","$await_7","runBeforeDispose","$If_1","$await_9","$await_10","$await_8","runAfterDispose","$await_11","$await_12","defineProperties","index$4","index$3","parse_1","compile_1","tokensToFunction_1","tokensToRegExp_1","Route","pluginMiddleware","plugins","ms","_m","component","children","entries","_keys","_regexp","list","childRoute","childPath","k","createRoutes","routes","events","click","ontouchstart","popstate","onInit","routers","Router","observable","link","setConfig","addEventListener","onclick","window","onpopstate","ref$1","passthrough","accum","update","getPathFromLocation","forEach","prototypeAccessors","staticAccessors","head","tail","initialized","config","hashbang","reverse","url","$If_2","$If_3","fromCtxChildren","fromCtx","toCtx","$Loop_6","$iterator_fromCtxChild_5","fromCtxChild","$await_13","$Loop_6_exit","$await_14","$If_4","$await_15","tasks","runEarly","$Loop_6_trampoline","history","state","title","search","hash","shouldNavigate","parseUrl","getPath","resolveRoute","assign$1","force","matchingRouteWithFewestDynamicSegments","fewestMatchingSegments","Infinity","rn","location","baseWithOrWithoutHashbangRegexp","dispose","unlink","removeEventListener","use","fns","usePlugin","useRoutes","resolve","e","defaultPrevented","el","target","nodeName","parentNode","isValidRoute","hasRoute","isCrossOrigin","sameOrigin","href","isDoubleClick","which","isDownload","hasAttribute","isEmptyHash","getAttribute","isMailto","hasExternalRel","hasModifier","metaKey","ctrlKey","shiftKey","hasOtherTarget","preventDefault","canonicalizePath","parser","createElement","b","toLowerCase","charAt","hostname","port","protocol","origin","event","button","bindingHandlers","init","valueAccessor","allBindings","viewModel","schedule","applyBindingsToNode","attr","pureComputed","css","active-path","components","register","synchronous","createViewModel","template","__ko_component_router__","$rawData","extend","controlsDescendantBindings"],"mappings":"CAAC,SAAUA,EAAQC,GACC,gBAAZC,UAA0C,mBAAXC,QAAyBA,OAAOD,QAAUD,EAAQG,QAAQ,aAC9E,kBAAXC,SAAyBA,OAAOC,IAAMD,OAAO,uBAAwB,YAAaJ,IACxFD,EAAOO,GAAKP,EAAOO,OAAUP,EAAOO,GAAGC,OAASP,EAAQD,EAAOO,MAC/DE,KAAM,SAAWF,GAAM,YAkBzB,SAASG,GAAeC,GACtB,MAAOC,GAASD,MAAO,GACoB,oBAAtCE,OAAOC,UAAUC,SAASC,KAAKL,GAyBtC,QAASM,GAAQC,GACb,MAA6B,kBAAfA,GAAIC,OAGtB,QAASC,GAAOC,GACZ,MAAoB,iBAANA,GAGlB,QAASC,GAAcD,GACnB,MAAOE,GAAMF,GAGjB,QAASG,GAASH,GACd,MAAoB,gBAANA,GAGlB,QAASI,GAAWJ,GAChB,MAAoB,kBAANA,GAGlB,QAASK,GAAYL,GACjB,MAAoB,mBAANA,GAGlB,QAASM,GAAQT,EAAKU,GAClB,MAAOV,GAAIW,OAAO,SAAUC,EAAWT,GACnC,GAAIU,GAAIH,EAAGP,EACX,OAAOS,GAAUE,OAAOf,EAAQc,GAAKA,GAAKA,SAIlD,QAASE,GAAcC,GAGnB,IAFA,GAAIC,GAAS1B,KACT2B,KAAWC,EAAMC,UAAUC,OAAS,EAChCF,KAAQ,GAAID,EAAMC,GAAQC,UAAWD,EAAM,EAEnD,IAAIG,KAuBJ,OAtBAN,GAAYA,EAAUO,IAAI,SAAUb,GAChC,GAAIc,GAASC,EAAaf,GAAIgB,MAAM,OAAQR,GACxCS,EAAM,WAAc,MAAO,IAAIC,SAAQ,SAAWC,EAASC,GAC3D,GAAIC,EAEJ,OADAA,GAAMP,EAAOQ,OACN,GAAIJ,SAAQ,SAAWC,EAASC,GACnC,MAAIG,GAAWF,GACJA,EAAIG,KAAKL,EAASC,GAEtBD,EAAQE,EAAII,QACpBC,KAAK7C,OAAO2C,KAAK,SAAWG,GAC3B,IAEI,MADAN,GAAMM,EACCR,EAAQE,IAAO,GACxB,MAAOO,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,IAChBM,KAAKnB,IAER,OADAK,GAAWiB,KAAKZ,GACTA,KAEHa,EAASd,MAAM,QAAUV,GAAYF,OAAQI,IAAQ,WAAc,MAAOsB,GAASd,MAAM,QAAUJ,GAAaR,OAAQI,MAGpI,QAASsB,GAASxB,GAEd,IADA,GAAIE,MAAWC,EAAMC,UAAUC,OAAS,EAChCF,KAAQ,GAAID,EAAMC,GAAQC,UAAWD,EAAM,EAEnD,OAAO,IAAIS,SAAQ,SAAWC,EAASC,GAuB/B,QAASW,KACL,OAAMC,EAAe,GAAKA,EAAe,GAAGV,QAAQW,OAAUC,EAAMF,EAAe,GAAGP,UAYxE,GAXHU,EAAUD,GAAKlB,MAAM,OAAQR,GAAMgB,KAAK,SAAWY,GACtD,IACI,MAAIA,MAAc,EACPjB,GAAQ,GAEZY,EACT,MAAOH,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GAM3B,QAASiB,KACL,MAAOlB,KAvCP,GAAIe,GACAI,EADKN,GAAkB1B,EAAUiC,OAAOC,YAE5C,QAAQF,EAAqB,SAAWG,GAGpC,IAFA,GAAIlC,GAAS1B,KAEN4D,GAAG,CACN,GAAIA,EAAEjB,KACA,WAAYiB,GAAEjB,KAAKc,EAAoBlB,EAC7C,KACI,GAAIqB,EAAEC,IACF,CAAE,GAAID,EAAE9B,OACN,MAAO8B,GAAEC,MAAQL,EAAajD,KAAKmB,GAAUkC,CAE7CA,GAAIV,MAEJU,GAAIA,EAAErD,KAAKmB,GACnB,MAAOoC,GACL,MAAOvB,GAAOuB,MAGvBjB,KAAK7C,OAAOkD,IAsBpBL,KAAK7C,OAGZ,QAAS+D,GAAYnD,GACjB,MAA8B,sBAAvBA,EAAEoD,YAAYC,KAGzB,QAASvB,GAAW9B,GAChB,OAAQK,EAAYL,IAAMI,EAAWJ,EAAE+B,MAG3C,QAAST,GAAaf,GAClB,MAAO4C,GAAY5C,GAAMA,EAAK,WAE1B,IADA,GAAIQ,MAAWC,EAAMC,UAAUC,OACvBF,KAAQD,EAAMC,GAAQC,UAAWD,EAEzC,IAAeY,GAAX0B,EAAQ,CACZ,QACIzB,KAAM,WACF,MAAO,IAAIJ,SAAQ,SAAWC,EAASC,GACnC,OAAQ2B,KACJ,IAAK,GACD,MAAOZ,GAAUnC,GAAIgB,MAAM,OAAQR,GAAMgB,KAAK,SAAWwB,GACrD,IAEI,MADA3B,GAAM2B,IAAa,EACZ,GAAI9B,SAAQ,SAAWC,EAASC,GACnC,MAAIC,IAAOA,EAAI4B,aACJd,EAAUd,EAAI4B,gBAAgBzB,KAAKL,EAASC,GAEhDD,EAAQE,IAChBK,KAAK7C,OAAO2C,KAAKL,EAASC,GAC/B,MAAOQ,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,EACnB,KAAK,GACD,MAAO,IAAIF,SAAQ,SAAWC,EAASC,GAYnC,QAAS8B,KACL,MAAO/B,GAAQgC,GAZnB,GAAIA,EACJ,QAAIA,EAAgB9B,GACTc,EAAUd,EAAI+B,eAAe5B,KAAK,SAAW6B,GAChD,IAEI,MADAF,GAAgBE,EACTH,EAAO9D,KAAKP,MACrB,MAAO+C,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GAMZ8B,EAAO9D,KAAKP,OACpB6C,KAAK7C,OAAO2C,KAAKL,EAASC,EACjC,KAAK,GACD,MAAO,IAAIF,SAAQ,SAAWC,EAASC,GAYnC,QAASkC,KACL,MAAOnC,GAAQoC,GAZnB,GAAIA,EACJ,QAAIA,EAAgBlC,GACTc,EAAUd,EAAImC,iBAAiBhC,KAAK,SAAWiC,GAClD,IAEI,MADAF,GAAgBE,EACTH,EAAOlE,KAAKP,MACrB,MAAO+C,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GAMZkC,EAAOlE,KAAKP,OACpB6C,KAAK7C,OAAO2C,KAAKL,EAASC,EACjC,KAAK,GACD,MAAO,IAAIF,SAAQ,SAAWC,EAASC,GAYnC,QAASsC,KACL,MAAOvC,GAAQwC,GAZnB,GAAIA,EACJ,QAAIA,EAAgBtC,GACTc,EAAUd,EAAIuC,gBAAgBpC,KAAK,SAAWqC,GACjD,IAEI,MADAF,GAAgBE,EACTH,EAAOtE,KAAKP,MACrB,MAAO+C,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GAMZsC,EAAOtE,KAAKP,OACpB6C,KAAK7C,OAAO2C,KAAKL,EAASC,GAErC,MAAOD,MACRO,KAAK7C,UAMxB,QAASsD,GAAUD,GACf,GAAI3B,GAAS1B,IAGb,OAFa,UAARqD,IAAiBA,EAAM,cAErB,WAEH,IADA,GAAI1B,MAAWC,EAAMC,UAAUC,OACvBF,KAAQD,EAAMC,GAAQC,UAAWD,EAEzC,OAAO,IAAIS,SAAQ,SAAWC,EAASC,GACvC,GAAIpB,GAAIqB,CAKR,OAJArB,GAAK,WAAe,MAAOkC,GAAIvB,SAAWH,EAAKG,OAAS,EAAI,GAAIO,SAAQ,SAAU4C,GAC9E5B,EAAIlB,MAAM,OAAQR,EAAKJ,QAAS0D,OAC/B5B,EAAIlB,MAAM,OAAQR,IACvBa,EAAMrB,IACC,GAAIkB,SAAQ,SAAWC,EAASC,GACnC,MAAIG,GAAWF,GACJA,EAAIG,KAAKL,EAASC,GAEtBD,EAAQE,IAChBK,KAAK7C,OAAO2C,KAAKL,EAASC,IAC9BM,KAAKnB,KAqMZ,QAASwD,GAAOC,EAAKC,GAQnB,IAPA,GAKIC,GALAC,KACAC,EAAM,EACNzE,EAAQ,EACR0E,EAAO,GACPC,EAAmBL,GAAWA,EAAQM,WAAa,IAGf,OAAhCL,EAAMM,EAAYC,KAAKT,KAAe,CAC5C,GAAIU,GAAIR,EAAI,GACRS,EAAUT,EAAI,GACdU,EAASV,EAAIvE,KAKjB,IAJA0E,GAAQL,EAAIa,MAAMlF,EAAOiF,GACzBjF,EAAQiF,EAASF,EAAE/D,OAGfgE,EACFN,GAAQM,EAAQ,OADlB,CAKA,GAAIrD,GAAO0C,EAAIrE,GACXmF,EAASZ,EAAI,GACbpB,EAAOoB,EAAI,GACXa,EAAUb,EAAI,GACdc,EAAQd,EAAI,GACZe,EAAWf,EAAI,GACfgB,EAAWhB,EAAI,EAGfG,KACFF,EAAOtC,KAAKwC,GACZA,EAAO,GAGT,IAAIc,GAAoB,MAAVL,GAA0B,MAARxD,GAAgBA,IAASwD,EACrDM,EAAsB,MAAbH,GAAiC,MAAbA,EAC7BI,EAAwB,MAAbJ,GAAiC,MAAbA,EAC/BV,EAAYL,EAAI,IAAMI,EACtBgB,EAAUP,GAAWC,CAEzBb,GAAOtC,MACLiB,KAAMA,GAAQsB,IACdU,OAAQA,GAAU,GAClBP,UAAWA,EACXc,SAAUA,EACVD,OAAQA,EACRD,QAASA,EACTD,WAAYA,EACZI,QAASA,EAAUC,EAAYD,GAAYJ,EAAW,KAAO,KAAOM,EAAajB,GAAa,SAclG,MATI5E,GAAQqE,EAAIrD,SACd0D,GAAQL,EAAIyB,OAAO9F,IAIjB0E,GACFF,EAAOtC,KAAKwC,GAGPF,EAUT,QAASuB,GAAS1B,EAAKC,GACrB,MAAO0B,GAAiB5B,EAAMC,EAAKC,IASrC,QAAS2B,GAA0B5B,GACjC,MAAO6B,WAAU7B,GAAK8B,QAAQ,UAAW,SAAUC,GACjD,MAAO,IAAMA,EAAEC,WAAW,GAAG7G,SAAS,IAAI8G,gBAU9C,QAASC,GAAgBlC,GACvB,MAAO6B,WAAU7B,GAAK8B,QAAQ,QAAS,SAAUC,GAC/C,MAAO,IAAMA,EAAEC,WAAW,GAAG7G,SAAS,IAAI8G,gBAO9C,QAASN,GAAkBxB,GAKzB,IAAK,GAHDgC,GAAU,GAAIC,OAAMjC,EAAOxD,QAGtB0F,EAAI,EAAGA,EAAIlC,EAAOxD,OAAQ0F,IACR,gBAAdlC,GAAOkC,KAChBF,EAAQE,GAAK,GAAIC,QAAO,OAASnC,EAAOkC,GAAGf,QAAU,MAIzD,OAAO,UAAUiB,EAAKC,GAMpB,IAAK,GALDnC,GAAO,GACPoC,EAAOF,MACPtC,EAAUuC,MACVE,EAASzC,EAAQ0C,OAASf,EAA2BgB,mBAEhDP,EAAI,EAAGA,EAAIlC,EAAOxD,OAAQ0F,IAAK,CACtC,GAAIQ,GAAQ1C,EAAOkC,EAEnB,IAAqB,gBAAVQ,GAAX,CAMA,GACIC,GADArF,EAAQgF,EAAKI,EAAM/D,KAGvB,IAAa,MAATrB,EAAe,CACjB,GAAIoF,EAAMxB,SAAU,CAEdwB,EAAM1B,UACRd,GAAQwC,EAAM/B,OAGhB,UAEA,KAAM,IAAIiC,WAAU,aAAeF,EAAM/D,KAAO,mBAIpD,GAAIkE,EAAQvF,GAAZ,CACE,IAAKoF,EAAMzB,OACT,KAAM,IAAI2B,WAAU,aAAeF,EAAM/D,KAAO,kCAAoCmE,KAAKC,UAAUzF,GAAS,IAG9G,IAAqB,IAAjBA,EAAMd,OAAc,CACtB,GAAIkG,EAAMxB,SACR,QAEA,MAAM,IAAI0B,WAAU,aAAeF,EAAM/D,KAAO,qBAIpD,IAAK,GAAIqE,GAAI,EAAGA,EAAI1F,EAAMd,OAAQwG,IAAK,CAGrC,GAFAL,EAAUJ,EAAOjF,EAAM0F,KAElBhB,EAAQE,GAAGe,KAAKN,GACnB,KAAM,IAAIC,WAAU,iBAAmBF,EAAM/D,KAAO,eAAiB+D,EAAMvB,QAAU,oBAAsB2B,KAAKC,UAAUJ,GAAW,IAGvIzC,KAAe,IAAN8C,EAAUN,EAAM/B,OAAS+B,EAAMtC,WAAauC,OApBzD,CA4BA,GAFAA,EAAUD,EAAM3B,SAAWgB,EAAezE,GAASiF,EAAOjF,IAErD0E,EAAQE,GAAGe,KAAKN,GACnB,KAAM,IAAIC,WAAU,aAAeF,EAAM/D,KAAO,eAAiB+D,EAAMvB,QAAU,oBAAsBwB,EAAU,IAGnHzC,IAAQwC,EAAM/B,OAASgC,OArDrBzC,IAAQwC,EAwDZ,MAAOxC,IAUX,QAASmB,GAAcxB,GACrB,MAAOA,GAAI8B,QAAQ,6BAA8B,QASnD,QAASP,GAAaP,GACpB,MAAOA,GAAMc,QAAQ,gBAAiB,QAUxC,QAASuB,GAAYC,EAAIC,GAEvB,MADAD,GAAGC,KAAOA,EACHD,EAST,QAASE,GAAOvD,GACd,MAAOA,GAAQwD,UAAY,GAAK,IAUlC,QAASC,GAAgBrD,EAAMkD,GAE7B,GAAII,GAAStD,EAAKuD,OAAOC,MAAM,YAE/B,IAAIF,EACF,IAAK,GAAItB,GAAI,EAAGA,EAAIsB,EAAOhH,OAAQ0F,IACjCkB,EAAK1F,MACHiB,KAAMuD,EACNvB,OAAQ,KACRP,UAAW,KACXc,UAAU,EACVD,QAAQ,EACRD,SAAS,EACTD,UAAU,EACVI,QAAS,MAKf,OAAO+B,GAAWhD,EAAMkD,GAW1B,QAASO,GAAezD,EAAMkD,EAAMtD,GAGlC,IAAK,GAFD8D,MAEK1B,EAAI,EAAGA,EAAIhC,EAAK1D,OAAQ0F,IAC/B0B,EAAMlG,KAAKmG,EAAa3D,EAAKgC,GAAIkB,EAAMtD,GAAS2D,OAGlD,IAAIK,GAAS,GAAI3B,QAAO,MAAQyB,EAAMG,KAAK,KAAO,IAAKV,EAAMvD,GAE7D,OAAOoD,GAAWY,EAAQV,GAW5B,QAASY,GAAgB9D,EAAMkD,EAAMtD,GACnC,MAAOmE,GAAerE,EAAMM,EAAMJ,GAAUsD,EAAMtD,GAWpD,QAASmE,GAAgBjE,EAAQoD,EAAMtD,GAChC+C,EAAQO,KACXtD,EAAkCsD,GAAQtD,EAC1CsD,MAGFtD,EAAUA,KAOV,KAAK,GALDoE,GAASpE,EAAQoE,OACjBC,EAAMrE,EAAQqE,OAAQ,EACtBC,EAAQ,GAGHlC,EAAI,EAAGA,EAAIlC,EAAOxD,OAAQ0F,IAAK,CACtC,GAAIQ,GAAQ1C,EAAOkC,EAEnB,IAAqB,gBAAVQ,GACT0B,GAAS/C,EAAaqB,OACjB,CACL,GAAI/B,GAASU,EAAaqB,EAAM/B,QAC5BC,EAAU,MAAQ8B,EAAMvB,QAAU,GAEtCiC,GAAK1F,KAAKgF,GAENA,EAAMzB,SACRL,GAAW,MAAQD,EAASC,EAAU,MAOpCA,EAJA8B,EAAMxB,SACHwB,EAAM1B,QAGCL,EAAS,IAAMC,EAAU,KAFzB,MAAQD,EAAS,IAAMC,EAAU,MAKnCD,EAAS,IAAMC,EAAU,IAGrCwD,GAASxD,GAIb,GAAIR,GAAYiB,EAAavB,EAAQM,WAAa,KAC9CiE,EAAoBD,EAAM1D,OAAON,EAAU5D,UAAY4D,CAkB3D,OAZK8D,KACHE,GAASC,EAAoBD,EAAM1D,MAAM,GAAIN,EAAU5D,QAAU4H,GAAS,MAAQhE,EAAY,WAI9FgE,GADED,EACO,IAIAD,GAAUG,EAAoB,GAAK,MAAQjE,EAAY,MAG3D8C,EAAW,GAAIf,QAAO,IAAMiC,EAAOf,EAAMvD,IAAWsD,GAe7D,QAASS,GAAc3D,EAAMkD,EAAMtD,GAQjC,MAPK+C,GAAQO,KACXtD,EAAkCsD,GAAQtD,EAC1CsD,MAGFtD,EAAUA,MAENI,YAAgBiC,QACXoB,EAAerD,EAA4B,GAGhD2C,EAAQ3C,GACHyD,EAAoC,EAA8B,EAAQ7D,GAG5EkE,EAAqC,EAA8B,EAAQlE,GAkepF,QAASwE,GAAYC,EAAYC,GAC7B,GAAIC,GAAMC,EAAiBH,EAAYC,GACnC/J,EAASgK,EAAI,GACbvE,EAAOuE,EAAI,EACf,OAAOhK,GAAOkK,KAAOzE,EAGzB,QAAS0E,GAAaL,EAAYC,GAC9B,GAAIC,GAAMC,EAAiBH,EAAYC,GACnC/J,EAASgK,EAAI,GACbvE,EAAOuE,EAAI,EACf,QAAQhK,EAAOoK,iBAAmBpK,EAAOqK,IAAIC,UAAY,OAAS,IAAM7E,EAAK8E,MAAM,KAAK,GAG5F,QAASN,GAAiBH,EAAYrE,GAClC,GAAIzF,GAASwK,EAAUV,EACvB,IAA2B,IAAvBrE,EAAKgF,QAAQ,MAEb,IADAhF,EAAOA,EAAKyB,QAAQ,KAAM,MAClBlH,EAAO0K,QACX1K,EAASA,EAAO2K,YAOpB,KAJ2B,IAAvBlF,EAAKgF,QAAQ,QACbhF,EAAOA,EAAKyB,QAAQ,KAAM,KAC1BlH,EAASA,EAAO4K,QAEbnF,GAAQA,EAAKwD,MAAM,cAAgBjJ,EAAO0K,QAC7C1K,EAASA,EAAO2K,QAChBlF,EAAOA,EAAKyB,QAAQ,WAAY,GAGxC,QAAQlH,EAAOyF,GAGnB,QAAS+E,GAAUV,GACf,MAAQ5I,EAAY4I,IAAa,CAC7B,IAAK5I,EAAY4I,EAAWe,SACxB,MAAOf,GAAWe,OAEtBf,GAAaA,EAAWgB,eAE5B,MAAOC,GAASC,IAAI,GA2BxB,QAASC,GAAaC,GAClB,QAASC,GAAYC,GACbrL,EAAGsL,aAAaH,EAAOE,MACvBE,QAAQC,KAAM,2CAA6CH,EAAI,2GAC/DF,EAAOE,GAAKrL,EAAGyL,OAAON,EAAOE,KAOrC,MAHAD,GAAY,UACZA,EAAY,QACZA,EAAY,YACLD,EA34CXnL,EAAK,WAAaA,GAAKA,EAAG,WAAaA,CASvC,IAAI0L,GAAU,SAAkBC,GAC9B,MAAc,OAAPA,GAA8B,gBAARA,KACvBlE,MAAM/G,QAAQiL,IAGlBtL,EAAWqL,EAOX1K,EAAQ,SAAuBZ,GACjC,GAAIwL,GAAKC,CAET,OAAI1L,GAAeC,MAAO,IAG1BwL,EAAOxL,EAAE8D,YACW,kBAAT0H,KAGXC,EAAOD,EAAKrL,UACRJ,EAAe0L,MAAU,GAGzBA,EAAKC,eAAe,oBAAqB,KAkP3CC,EAAU,SAAiBZ,GAC3B7K,OAAO0L,OAAO9L,KAAMiL,GACpBjL,KAAK+L,SAAW/L,KAAKD,OAAOkK,KAAOjK,KAAKqK,SACxCrK,KAAKgM,cAAgBhM,KAAK+L,SAAS9E,QAAQ,GAAIQ,QAAOzH,KAAKD,OAAOkM,MAAMhC,KAAM,KAAM,IACpFjK,KAAKkM,UACLlM,KAAKmM,4BACLnM,KAAKoM,yBACLpM,KAAKqM,2BACLrM,KAAKsM,2BAGLC,GAAyB7B,WAAY8B,YAAa7B,UAAW8B,aAAcC,WAC/Eb,GAAQxL,UAAUsM,0BAA4B,SAAoCC,GAC9E5M,KAAKmM,yBAAyBU,QAAQD,IAE1CL,EAAqB7B,QAAQK,IAAM,WAC/B,MAAO/K,MAAKD,OAAO0K,OAASqC,OAAY9M,KAAKD,OAAO2K,QAAQN,KAEhEmC,EAAqBC,SAASzB,IAAM,WAChC,MAAO/K,MAAKD,OAAOyM,SAASxK,IAAI,SAAUiD,GAAK,MAAOA,GAAEmF,OAE5DmC,EAAqB5B,OAAOI,IAAM,WAC9B,MAAO9J,GAAYjB,KAAKD,OAAO4K,QAAUmC,OAAY9M,KAAKD,OAAO4K,OAAOP,KAE5EmC,EAAqBE,UAAU1B,IAAM,WACjC,MAAO/K,MAAKD,OAAO0M,UAAUzK,IAAI,SAAUiD,GAAK,MAAOA,GAAEmF,OAE7DmC,EAAqBG,QAAQ3B,IAAM,WAC/B,MAAOgC,UAASC,uBAAuB,4BAA4BhN,KAAKD,OAAOkN,QAEnFpB,EAAQxL,UAAU6M,2BAA6B,WAC3C,MAAO,IAAI7K,SAAQ,SAAWC,EAASC,GACnC,GAAI6H,GAAK3I,CAGT,KAFA2I,EAAMpK,KACNyB,KACO2I,GACH3I,EAAY2I,EAAI+B,yBAAyB5K,OAAQE,GACjD2I,EAAMA,EAAIO,MAEd,OAAO1H,GAASxB,GAAWkB,KAAKL,EAASC,IAC1CM,KAAK7C,QAEZ6L,EAAQxL,UAAU8M,MAAQ,SAAgBC,GACtCpN,KAAKkM,OAAOlJ,KAAKoK,IAErBvB,EAAQxL,UAAUgN,WAAa,WAC3B,MAAO,IAAIhL,SAAQ,SAAWC,EAASC,GAC/B,GAAIb,GAAS1B,IAEjB,OAAOsC,GAAQD,QAAQiL,IAAItN,KAAKkM,QAAQvJ,KAAK,WAAc,MAAOjB,GAAOwK,cAC1ErJ,KAAK7C,QAEZ6L,EAAQxL,UAAUkN,gBAAkB,WAChC,MAAO,IAAIlL,SAAQ,SAAWC,EAASC,GACnC,GAAIiL,GAAiBC,EAAeC,EAAmBC,EACnD7B,CAKJ,OAJKA,GAAStK,EAAcsJ,EAAS8C,WAAY5N,MAAOwN,EAAkB1B,EAAO,GAAI2B,EAAgB3B,EAAO,GAC5G9L,KAAKoM,sBAAsBpJ,KAAKyK,GAChCzN,KAAKqM,wBAAwBrJ,KAAKyK,GAClCzN,KAAKsM,uBAAuBtJ,KAAKyK,GAC1BD,EAAgB7K,KAAK,SAAWkL,GACnC,IACI,GAAI/B,EAKJ,OAJKA,GAAStK,EAAcxB,KAAK0J,MAAMkE,WAAY5N,MAAO0N,EAAoB5B,EAAO,GAAI6B,EAAkB7B,EAAO,GAClH9L,KAAKoM,sBAAsBpJ,KAAK2K,GAChC3N,KAAKqM,wBAAwBQ,QAAQc,GACrC3N,KAAKsM,uBAAuBO,QAAQc,GAC7BD,EAAkB/K,KAAK,SAAWmL,GACrC,IACI,MAAO9N,MAAKqN,aAAa1K,KAAK,SAAWoL,GACrC,IACI,MAAOzL,KACT,MAAOS,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GACjB,MAAOQ,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GACjB,MAAOQ,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,IAChBM,KAAK7C,QAEZ6L,EAAQxL,UAAU2N,eAAiB,WAC/B,MAAO,IAAI3L,SAAQ,SAAWC,EAASC,GACnC,MAAOU,GAASjD,KAAKoM,uBAAuBzJ,KAAK,SAAWsL,GACxD,IACI,MAAOjO,MAAKqN,aAAa1K,KAAK,SAAWuL,GACrC,IACI,MAAO5L,KACT,MAAOS,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GACjB,MAAOQ,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,IAChBM,KAAK7C,QAEZ6L,EAAQxL,UAAU8N,iBAAmB,WACjC,MAAO,IAAI9L,SAAQ,SAAWC,EAASC,GAUnC,QAAS6L,KACL,MAAOnL,GAASjD,KAAKqM,yBAAyB1J,KAAK,SAAW0L,GAC1D,IACI,MAAOrO,MAAKqN,aAAa1K,KAAK,SAAW2L,GACrC,IACI,MAAOhM,KACT,MAAOS,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GACjB,MAAOQ,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GAtBnB,MAAIvC,MAAK2K,OACE3K,KAAK2K,OAAOwD,mBAAmBxL,KAAK,SAAW4L,GAClD,IACI,MAAOH,GAAM7N,KAAKP,MACpB,MAAO+C,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GAkBZ6L,EAAM7N,KAAKP,OACnB6C,KAAK7C,QAEZ6L,EAAQxL,UAAUmO,gBAAkB,WAChC,MAAO,IAAInM,SAAQ,SAAWC,EAASC,GACnC,MAAOU,GAASjD,KAAKsM,wBAAwB3J,KAAK,SAAW8L,GACzD,IACI,MAAOzO,MAAKqN,aAAa1K,KAAK,SAAW+L,GACrC,IACI,MAAOpM,KACT,MAAOS,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GACjB,MAAOQ,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,IAChBM,KAAK7C,QAGZI,OAAOuO,iBAAkB9C,EAAQxL,UAAWkM,EAE5C,IAAIqC,GAAUrH,MAAM/G,SAAW,SAAUC,GACvC,MAA8C,kBAAvCL,OAAOC,UAAUC,SAASC,KAAKE,IAGpC0H,EAAUyG,EAKVC,EAAU1F,EACV2F,EAAU5J,EACV6J,EAAYlI,EACZmI,EAAqBlI,EACrBmI,EAAmB1F,EAOnB5D,EAAc,GAAI8B,SAGpB,UAOA,0GACA4B,KAAK,KAAM,IAgZbwF,GAAQ3J,MAAQ4J,EAChBD,EAAQhI,QAAUkI,EAClBF,EAAQ/H,iBAAmBkI,EAC3BH,EAAQtF,eAAiB0F,CAEzB,IAAIC,GAAQ,QAASA,IAAM1J,EAAMoI,GAC7B,GAAIlM,GAAS1B,IAEbA,MAAK4N,WAAa1M,EAAQV,EAAQoN,GAAcA,GAAcA,GAAa,SAAU/H,GACjF,GAAIsJ,GAAmBrE,EAASsE,QAAQhO,OAAO,SAAUiO,EAAIlE,GACzD,GAAImE,GAAKnE,EAAEtF,EACX,OAAOyJ,GAAKD,EAAG9N,OAAOf,EAAQ8O,GAAMA,GAAMA,IAAOD,MAErD,OAAOF,GAAiBrN,OAAS,EAAIqN,EAAmBtJ,IACzDzE,OAAO,SAAUiO,EAAIxJ,GAiBpB,MAhBI9E,GAAS8E,GACTnE,EAAO6N,UAAY1J,EACZhF,EAAcgF,IACrBL,EAAOA,EAAKyB,QAAQ,SAAU,MAC9BvF,EAAO8N,SAAWpP,OAAOqP,QAAQ5J,GAAG7D,IAAI,SAAU+H,GAC9C,GAAI9E,GAAI8E,EAAI,GACRlE,EAAIkE,EAAI,EAEZ,OAAO,IAAImF,IAAMjK,EAAGY,KAEnBnE,EAAO6N,YACR7N,EAAO6N,UAAY,wBAEhBvO,EAAW6E,IAClBwJ,EAAGrM,KAAK6C,GAELwJ,OAGP7J,EAD0B,MAA1BA,EAAKA,EAAK1D,OAAS,GACZ0D,EAAKyB,QAAQ,IAAK,wBAElBzB,EAAKyB,QAAQ,WAAY,QAEpCjH,KAAKwF,KAAOA,EACZxF,KAAK0P,SACL1P,KAAK2P,QAAUd,EAAQrJ,EAAMxF,KAAK0P,OAEtCR,GAAM7O,UAAUiH,QAAU,QAASA,IAAS9B,GACpC,GAAI9D,GAAS1B,KAEbsH,GAAUtH,KAAK2P,QAAQ/J,KAAKJ,EAChC,IAAgB,OAAZ8B,GACA,OAAO,CAEX,IAAItH,KAAKwP,SAAU,CACf,IAAK,GAAIhI,GAAI,EAAGoI,EAAOlO,EAAO8N,SAAUhI,EAAIoI,EAAK9N,OAAQ0F,GAAK,EAAG,CAC7D,GAAIqI,GAAaD,EAAKpI,GAEdsI,EAAY,KAAOxI,GAAQA,GAAQxF,OAAS,IAAM,GAC1D,IAAI+N,EAAWvI,QAAQwI,GACnB,OAAO,EAGf,OAAO,EAEX,OAAO,GAEXZ,EAAM7O,UAAU6E,MAAQ,SAAmBM,GAMvC,IAAK,GAHDsK,GAFIpO,EAAS1B,KAGbiL,KACA3D,EAAUtH,KAAK2P,QAAQ/J,KAAKJ,GACvBgC,EAAI,EAAG5F,EAAM0F,EAAQxF,OAAO0F,EAAI5F,IAAO4F,EAAG,CAC/C,GAAIuI,GAAIrO,EAAOgO,MAAMlI,EAAI,GACrBlG,EAAIgG,EAAQE,IAAM,EACP,oBAAXuI,EAAE9L,KACF6L,EAAY,IAAMxO,EAElB2J,EAAO8E,EAAE9L,MAAQ3C,EAGzB,OAAQ2J,EAAOzF,EAAKyB,QAAQ,GAAIQ,QAAOqI,EAAY,KAAM,IAAIA,IAEjEZ,EAAMc,aAAe,SAAuBC,GACxC,MAAO7P,QAAOqP,QAAQQ,GAAQjO,IAAI,SAAU+H,GACpC,GAAI9E,GAAI8E,EAAI,GACRlE,EAAIkE,EAAI,EAEZ,OAAO,IAAImF,GAAMjK,EAAGY,KAIhC,IAAIqK,IACAC,MAAOpD,SAASqD,aAAe,aAAe,QAC9CC,SAAU,YAEVC,KACAC,KACAzF,EAAW,QAAS0F,IAAOvF,GAC3B,GAAIvJ,GAAS1B,IAEbA,MAAKuP,UAAYzP,EAAG2Q,aACpBzQ,KAAKmK,aAAerK,EAAG2Q,YAAW,GAClCzQ,KAAKiQ,OAASf,EAAMc,aAAa/E,EAAOgF,YACxCO,GAAOE,KAAK1Q,MACRA,KAAKyK,QACL+F,GAAOG,UAAU1F,IAChBlB,EAAM/J,KAAKiQ,QAAQjN,KAAKb,MAAM4H,EAAKmF,EAAMc,aAAaQ,GAAOP,SAC9DlD,SAAS6D,iBAAiBV,EAAOC,MAAOK,GAAOK,SAC/CC,OAAOF,iBAAiBV,EAAOG,SAAUG,GAAOO,aACzC/Q,KAAK0K,QAAQN,IAAIV,MAAM8F,WAC7BwB,EAAQhR,KAAKiQ,QAAQjN,KAAKb,MAAM6O,EAAOhR,KAAK0K,QAAQN,IAAIV,MAAM8F,UAEnExP,KAAKiR,YAAc7Q,OAAOqP,QAAQxE,GAAQ7J,OAAO,SAAU8P,EAAOnH,GAC9D,GAAIgG,GAAIhG,EAAI,GACRzI,EAAIyI,EAAI,EAEZ,OAAa,SAANgG,GAAsB,aAANA,GAA0B,WAANA,EAAiBmB,EAAQ9Q,OAAO0L,OAAOoF,GAASxJ,KAAUA,EAAIqI,GAAKzO,EAAGoG,GACjH,IAAIA,QAER1H,KAAKmR,OAAOnR,KAAKoR,uBAAuB,GAAOzO,KAAK,WAAc,MAAO2N,GAAOe,QAAQ,SAAUpM,GAAK,MAAOA,GAAEvD,MAChH,IAAIqI,GACAiH,GAGJM,GAAuBrH,QAASS,WAAY8B,YAAa7B,UAAW8B,cACpE8E,GAAoBC,QAASC,QAASC,eAub1C,OAtbAJ,GAAmBrH,KAAKc,IAAM,WAC1B,MAAO/K,MAAKyK,OAASK,EAAS6G,OAAO1H,MAAQa,EAAS6G,OAAOC,SAAW,MAAQ,IAAM5R,KAAK0K,QAAQT,KAAOjK,KAAK0K,QAAQN,IAAIC,UAE/HiH,EAAmB5G,QAAQK,IAAM,WAC7B,MAAOwF,GAAQvQ,KAAKiN,MAAQ,IAEhCqE,EAAmB9E,SAASzB,IAAM,WAC9B,MAAOwF,GAAQvK,MAAM,EAAGhG,KAAKiN,OAAO4E,WAExCP,EAAmB3G,OAAOI,IAAM,WAC5B,MAAOwF,GAAQvQ,KAAKiN,MAAQ,IAEhCqE,EAAmB7E,UAAU1B,IAAM,WAC/B,MAAOwF,GAAQvK,MAAMhG,KAAKiN,MAAQ,IAEtCnC,EAASzK,UAAU8Q,OAAS,SAAiBW,EAAKnQ,GAC9C,MAAO,IAAIU,SAAQ,SAAWC,EAASC,GAiCnC,QAAS6L,KAeL,QAAS2D,KAkBL,QAASC,KAEL,MADAC,GAAkBC,GAAWA,EAAQzF,UAAUoF,UACxCM,EAAM5E,kBAAkB5K,KAAK,SAAW+L,GA8B/B,QAAS0D,KACL,OAAMC,EAAyB,GAAKA,EAAyB,GAAG5P,QAAQW,OAAUkP,EAAeD,EAAyB,GAAGzP,UAS/G,GARH0P,EAAa9D,kBAAkB7L,KAAK,SAAW4P,GAClD,IACI,MAAOH,GACT,MAAOrP,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GAM3B,QAASiQ,KACL,MAAON,GAAQ1D,kBAAkB7L,KAAK,SAAW8P,GAC7C,IACI,MAAOC,GAAMnS,KAAKP,MACpB,MAAO+C,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GAIvB,QAASmQ,KACL,MAAOP,GAAMnE,iBAAiBrL,KAAK,SAAWgQ,GAC1C,IAEI,MADA3S,MAAKmK,cAAa,GACX7H,GAAQ,GACjB,MAAOS,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GA9DvB,IAMI,GALAvC,KAAKoK,IAAM+H,EACXnS,KAAKuP,WAAU,GACfzP,EAAG8S,MAAMC,WACT7S,KAAKuP,UAAUvP,KAAKoK,IAAIV,MAAM6F,WAC9BzP,EAAG8S,MAAMC,WACLX,EAAS,CAEL,GAAII,GACAQ,EADcT,GAA4BJ,EAAgBvO,OAAOC,YAErE,QAAQmP,EAAqB,SAAWlP,GAGpC,IAFI,GAAIlC,GAAS1B,KAEV4D,GAAG,CACN,GAAIA,EAAEjB,KACA,WAAYiB,GAAEjB,KAAKmQ,EAAoBvQ,EAC7C,KACI,GAAIqB,EAAEC,IACF,CAAE,GAAID,EAAE9B,OACN,MAAO8B,GAAEC,MAAQ2O,EAAajS,KAAKmB,GAAUkC,CAE7CA,GAAIwO,MAEJxO,GAAIA,EAAErD,KAAKmB,GACnB,MAAOoC,GACL,MAAOvB,GAAOuB,MAGvBjB,KAAK7C,OAAOoS,GAqCvB,MAAOM,GAAMnS,KAAKP,MACpB,MAAO+C,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GAjFnB,MARAwQ,SAAQpR,EAAKqB,KAAO,YAAc,gBAAgB+P,QAAQC,MAAOjG,SAASkG,MAAOjT,KAAKiK,KAAOzE,EAAO0N,EAASC,GAC7GhB,EAAQ,GAAItG,GAAQzL,OAAO0L,UAAWnK,EAAAA,QAAW3B,KAAKiR,aAClDlR,OAAQC,KACRiL,OAAQA,EACRvB,MAAOA,EACPlE,KAAMA,EACN6E,SAAUA,KAEV6H,EACOA,EAAQ/D,mBAAmBxL,KAAK,SAAW8L,GAC9C,IACI,MAAOuD,GAAMzR,KAAKP,MACpB,MAAO+C,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GA6EZyP,EAAMzR,KAAKP,MA3GtB,MAAIkS,GACOA,EAAQhF,6BAA6BvK,KAAK,SAAW2L,GACxD,IAEI,MADA8E,GAAiB9E,EACb8E,KAAmB,EACZ9Q,GAAQ,IAEnBtC,KAAKmK,cAAa,GACX4H,EAAMxR,KAAKP,OACpB,MAAO+C,GACL,MAAOR,GAAOQ,KAEnBF,KAAK7C,MAAOuC,GAkGZwP,EAAMxR,KAAKP,MA/ItB,GAAIkS,GAASgB,EAAQC,EAAM3N,EAAMkE,EAAOuB,EAAQZ,EAAUyF,EAAWsD,EAAgBjB,EAAOF,CAC5FC,GAAUlS,KAAKoK,IACXzJ,EAAOgB,GACPA,GACIqB,KAAMrB,GAEHV,EAAYU,KACnBA,MAEAV,EAAYU,EAAKqB,QACjBrB,EAAKqB,MAAO,GAEZ/B,EAAYU,EAAAA,WACZA,EAAAA,WAEJ,IAAImK,EAIJ,IAHMA,EAAShB,EAASuI,SAASvB,GAAMoB,EAASpH,EAAOoH,OAAQC,EAAOrH,EAAOqH,KAC7E3N,EAAOsF,EAASwI,QAAQxB,GACxBpI,EAAQ1J,KAAKuT,aAAa/N,IACrBkE,EACD,MAAOpH,IAAQ,EAEnB,IAAIkR,EAEJ,OADKA,GAAW9J,EAAMxE,MAAMM,GAAOyF,EAASuI,EAAS,GAAInJ,EAAWmJ,EAAS,GAAI1D,EAAY0D,EAAS,GAClGtB,GAAWA,EAAQ7H,WAAaA,IAAa1I,EAAK8R,MAC9CzT,KAAK2K,OACE3K,KAAK2K,OAAOwG,OAAOrB,EAAYoD,EAASC,EAAMxR,GAAMgB,KAAKL,EAASC,GAElED,GAAQ,GAsHhB8L,EAAM7N,KAAKP,OACnB6C,KAAK7C,QAEZ8K,EAASzK,UAAUkT,aAAe,SAAuB/N,GACjD,GAEAkO,GAFIhS,EAAS1B,KAGb2T,EAAyBC,EAAAA,CAC7B,KAAK,GAAIC,KAAMnS,GAAOuO,OAAQ,CAC1B,GAAIhL,GAAIvD,EAAOuO,OAAO4D,EACtB,IAAI5O,EAAEqC,QAAQ9B,GAAO,CACjB,GAAuB,IAAnBP,EAAEyK,MAAM5N,OACR,MAAOmD,IACA0O,IAA2BC,EAAAA,GAAY3O,EAAEyK,MAAM5N,OAAS6R,GAAiD,OAAvB1O,EAAEyK,MAAM,GAAGjJ,WACpGkN,EAAyB1O,EAAEyK,MAAM5N,OACjC4R,EAAyCzO,IAIrD,MAAOyO,IAEX5I,EAASzK,UAAU+Q,oBAAsB,WACrC,GAAI5L,GAAOsO,SAASzJ,SAAWyJ,SAASZ,OAASY,SAASX,KACtDY,EAAkC/T,KAAKiK,KAAKhD,QAAQ,KAAM,OAC9D,OAAOzB,GAAKyB,QAAQ,GAAIQ,QAAOsM,EAAiC,KAAM,KAE1EjJ,EAASzK,UAAU2T,QAAU,WACrB,GAAItS,GAAS1B,IAEjB8K,GAASmJ,SACLjU,KAAKyK,SACLsC,SAASmH,oBAAoBhE,EAAOC,MAAOrF,EAAS+F,SAAS,GAC7DC,OAAOoD,oBAAoBhE,EAAOG,SAAUvF,EAASiG,YAAY,GACjE/Q,KAAKoK,IAAI+D,mBAAmBxL,KAAK,WAAc,MAAOjB,GAAO0I,IAAIoE,sBAGzE1D,EAAS6F,UAAY,SAAoB5G,GACjC,GAAIE,GAAOF,EAAIE,KACX2H,EAAW7H,EAAI6H,QAEnB3H,KACAa,EAAS6G,OAAO1H,KAAOA,GAEvB2H,IACA9G,EAAS6G,OAAOC,SAAWA,IAGnC9G,EAASqJ,IAAM,WAEP,IADA,GAAIC,MAAUxS,EAAMC,UAAUC,OACtBF,KAAQwS,EAAKxS,GAAQC,UAAWD,IAE3CmI,EAAMe,EAAS8C,YAAY5K,KAAKb,MAAM4H,EAAKqK,EACxC,IAAIrK,IAEZe,EAASuJ,UAAY,WAEb,IADA,GAAID,MAAUxS,EAAMC,UAAUC,OACtBF,KAAQwS,EAAKxS,GAAQC,UAAWD,IAE3CmI,EAAMe,EAASsE,SAASpM,KAAKb,MAAM4H,EAAKqK,EACrC,IAAIrK,IAEZe,EAASwJ,UAAY,SAAoBrE,GACrC7P,OAAO0L,OAAOhB,EAASmF,OAAQA,IAEnCnF,EAASC,IAAM,SAAcvD,GACzB,MAAO+I,GAAQ/I,IAEnB+J,EAAgBC,KAAKzG,IAAM,WACvB,MAAOwF,GAAQ,IAEnBgB,EAAgBE,KAAK1G,IAAM,WACvB,MAAOwF,GAAQA,EAAQzO,OAAS,IAEpCyP,EAAgBG,YAAY3G,IAAM,WAC9B,MAAuB,KAAnBwF,EAAQzO,OACD,GAAIO,SAAQ,SAAUkS,GAAW,MAAOjE,GAAOtN,KAAKuR,KAEpDlS,QAAQkS,QAAQzJ,EAAS0G,OAGxC1G,EAASqG,OAAS,WAEV,IADA,GAAIxP,MAAWC,EAAMC,UAAUC,OACvBF,KAAQD,EAAMC,GAAQC,UAAWD,EAE7C,OAAO,IAAIS,SAAQ,SAAWC,EAASC,GACnC,OAAQwH,EAAMwG,EAAQ,IAAIY,OAAOhP,MAAM4H,EAAKpI,GAAMgB,KAAKL,EAASC,EAC5D,IAAIwH,IACTlH,KAAK7C,QAEZ8K,EAAS4F,KAAO,SAAe3Q,GAC3BA,EAAOkN,MAAQsD,EAAQzO,OACvB/B,EAAO0K,OAA0B,IAAjB1K,EAAOkN,MACvBsD,EAAQvN,KAAKjD,GACbA,EAAOkM,MAAQsE,EAAQ,IAE3BzF,EAASmJ,OAAS,WACd1D,EAAQ1M,OAEZiH,EAAS+F,QAAU,SAAkB2D,GACjC,IAAIA,EAAEC,iBAAN,CAIA,IADA,GAAIC,GAAKF,EAAEG,OACJD,GAAM,MAAQA,EAAGE,UACpBF,EAAKA,EAAGG,UAEZ,IAAKH,GAAM,MAAQA,EAAGE,SAAtB,CAGA,GAAIvK,GAAWqK,EAAGrK,SACV6I,EAASwB,EAAGxB,OACZC,EAAOuB,EAAGvB,IAAoB,UAATA,IAAkBA,EAAO,GACtD,IAAI3N,IAAQ6E,EAAW6I,EAASC,GAAMlM,QAAQ,GAAIQ,QAAO8I,EAAQ,GAAGtG,KAAM,KAAM,IAC5E6K,EAAehK,EAASiK,SAASvP,GACjCwP,GAAiBlK,EAASmK,WAAWP,EAAGQ,MACxCC,EAAgB,IAAMrK,EAASsK,MAAMZ,GACrCa,EAAaX,EAAGY,aAAa,YAC7BC,EAA0C,MAA5Bb,EAAGc,aAAa,QAC9BC,EAAkE,KAAtDf,EAAGc,aAAa,SAAW,IAAIhL,QAAQ,WACnDkL,EAA4C,aAA3BhB,EAAGc,aAAa,OACjCG,EAAcnB,EAAEoB,SAAWpB,EAAEqB,SAAWrB,EAAEsB,SAC1CC,EAAiBrB,EAAGY,aAAa,WAChCR,GAAgBE,GAAiBG,GAAiBE,GAAcE,GAAeE,GAAYC,GAAkBC,GAAeI,IAGjIjL,EAASqG,OAAO3L,GAChBgP,EAAEwB,qBAENlL,EAASiG,WAAa,SAAqByD,GACvC1J,EAASqG,OAAOZ,EAAQ,GAAGa,uBAAuB,GAClDoD,EAAEwB,kBAENlL,EAASmL,iBAAmB,SAA2BzQ,GACnD,MAAOA,GAAKyB,QAAQ,GAAIQ,QAAO,YAAa,MAEhDqD,EAASuI,SAAW,SAAmBvB,GACnC,GAAIoE,GAASnJ,SAASoJ,cAAc,KAChCC,EAAI7F,EAAQ,GAAGtG,KAAKoM,aAKxB,OAJID,IAAsC,IAAjCtE,EAAIuE,cAAc7L,QAAQ4L,KAC/BtE,EAAMA,EAAI7K,QAAQ,GAAIQ,QAAO2O,EAAG,KAAM,KAAO,KAEjDF,EAAOhB,KAAOpK,EAASmL,iBAAiBnE,IAEpCqB,KAAM+C,EAAO/C,KACb9I,SAAwC,MAA9B6L,EAAO7L,SAASiM,OAAO,GAAaJ,EAAO7L,SAAW,IAAM6L,EAAO7L,SAC7E6I,OAAQgD,EAAOhD,SAGvBpI,EAASwI,QAAU,SAAkBxB,GACjC,MAAOhH,GAASuI,SAASvB,GAAKzH,UAElCS,EAASiK,SAAW,SAAmBvP,GACnC,OAAQvE,EAAY6J,EAAS0G,KAAK+B,aAAazI,EAASwI,QAAQ9N,MAEpEsF,EAASmK,WAAa,SAAqBC,GACvC,GAAIqB,GAAWzC,SAASyC,SAChBC,EAAO1C,SAAS0C,KAChBC,EAAW3C,SAAS2C,SACxBC,EAASD,EAAW,KAAOF,CAI/B,OAHIC,KACAE,GAAU,IAAMF,GAEbtB,GAAiC,IAAzBA,EAAK1K,QAAQkM,IAEhC5L,EAASsK,MAAQ,SAAgBZ,GAE7B,MADAA,GAAIA,GAAK1D,OAAO6F,MACT,OAASnC,EAAEY,MAAQZ,EAAEoC,OAASpC,EAAEY,OAG3ChV,OAAOuO,iBAAkB7D,EAASzK,UAAWiR,GAC7ClR,OAAOuO,iBAAkB7D,EAAUyG,GACnCzG,EAAS6G,QACL1H,KAAM,GACN2H,UAAU,GAEd9G,EAAS8C,cACT9C,EAASsE,WACTtE,EAASmF,UAETnQ,EAAG+W,gBAAgBrR,MACfsR,KAAM,SAAcpC,EAAIqC,EAAeC,EAAaC,EAAWpN,GAC3DiB,EAAS4G,YAAY/O,KAAK,WACtB7C,EAAG8S,MAAMsE,SAAS,WAAc,MAAOpX,GAAGqX,oBAAoBzC,GAC1D0C,MACIlC,KAAMpV,EAAGuX,aAAa,WAAc,MAAOzN,GAAYC,EAAY/J,EAAGyL,OAAOwL,SAEjFO,KACIC,cAAezX,EAAGuX,aAAa,WAAc,MAAOnN,GAAaL,EAAY/J,EAAGyL,OAAOwL,iBAkD3GjX,EAAG0X,WAAWC,SAAS,uBACnBC,aAAa,EACbT,WACIU,gBAAiB,SAAU1M,GAAU,MAAO,IAAIH,GAASE,EAAaC,MAE1E2M,SAAU,wIAEd9X,EAAG+W,gBAAgBgB,yBACff,KAAM,SAAcpC,EAAIqC,EAAeC,EAAaC,EAAWpN,GAC3D,GAAIe,GAAUf,EAAWiO,QAUzB,OATAhY,GAAGqX,oBAAoBzC,GACnB4C,IAAK1M,EAAQ2E,UACbA,WACItL,KAAM2G,EAAQ2E,UACdtE,OAAQL,EAAQR,MAErBP,EAAWkO,QACVnN,QAASA,MAGToN,4BAA4B,KAkBjClN","file":"ko-component-router.min.js","sourcesContent":["(function (global, factory) {\r\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('knockout')) :\r\n\ttypeof define === 'function' && define.amd ? define('ko-component-router', ['knockout'], factory) :\r\n\t(global.ko = global.ko || {}, global.ko.router = factory(global.ko));\r\n}(this, (function (ko) { 'use strict';\r\n\r\nko = 'default' in ko ? ko['default'] : ko;\r\n\r\n/*!\r\n * isobject <https://github.com/jonschlinkert/isobject>\r\n *\r\n * Copyright (c) 2014-2015, Jon Schlinkert.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nvar index$1 = function isObject(val) {\r\n  return val != null && typeof val === 'object'\r\n    && !Array.isArray(val);\r\n};\r\n\r\nvar isObject = index$1;\r\n\r\nfunction isObjectObject(o) {\r\n  return isObject(o) === true\r\n    && Object.prototype.toString.call(o) === '[object Object]';\r\n}\r\n\r\nvar index = function isPlainObject(o) {\r\n  var ctor,prot;\r\n  \r\n  if (isObjectObject(o) === false) return false;\r\n  \r\n  // If has modified constructor\r\n  ctor = o.constructor;\r\n  if (typeof ctor !== 'function') return false;\r\n  \r\n  // If has modified prototype\r\n  prot = ctor.prototype;\r\n  if (isObjectObject(prot) === false) return false;\r\n  \r\n  // If constructor does not have an Object-specific method\r\n  if (prot.hasOwnProperty('isPrototypeOf') === false) {\r\n    return false;\r\n  }\r\n  \r\n  // Most likely a plain Object\r\n  return true;\r\n};\r\n\r\nfunction isArray(arr) {\r\n    return typeof arr.splice === 'function';\r\n}\r\n\r\nfunction isBool(x) {\r\n    return typeof x === 'boolean';\r\n}\r\n\r\nfunction isPlainObject(x) {\r\n    return index(x);\r\n}\r\n\r\nfunction isString(x) {\r\n    return typeof x === 'string';\r\n}\r\n\r\nfunction isFunction(x) {\r\n    return typeof x === 'function';\r\n}\r\n\r\nfunction isUndefined(x) {\r\n    return typeof x === 'undefined';\r\n}\r\n\r\nfunction flatMap(arr, fn) {\r\n    return arr.reduce(function (flattened, x) {\r\n        var v = fn(x);\r\n        return flattened.concat(isArray(v) ? v : [v]);\r\n    }, []);\r\n}\r\n\r\nfunction runMiddleware(callbacks) {\r\n    var this$1 = this;\r\n    var args = [], len = arguments.length - 1;\r\n    while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\r\n\r\n    var downstream = [];\r\n    callbacks = callbacks.map(function (fn) {\r\n        var runner = generatorify(fn).apply(void 0, args);\r\n        var run = function () { return new Promise((function ($return, $error) {\r\n            var ret;\r\n            ret = runner.next();\r\n            return new Promise((function ($return, $error) {\r\n                if (isThenable(ret)) {\r\n                    return ret.then($return, $error);\r\n                }\r\n                return $return(ret.value);\r\n            }).bind(this)).then((function ($await_18) {\r\n                try {\r\n                    ret = $await_18;\r\n                    return $return(ret || true);\r\n                } catch ($boundEx) {\r\n                    return $error($boundEx);\r\n                }\r\n            }).bind(this), $error);\r\n        }).bind(this$1)); };\r\n        downstream.push(run);\r\n        return run;\r\n    });\r\n    return [sequence.apply(void 0, [ callbacks ].concat( args )),function () { return sequence.apply(void 0, [ downstream ].concat( args )); }];\r\n}\r\n\r\nfunction sequence(callbacks) {\r\n    var args = [], len = arguments.length - 1;\r\n    while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\r\n\r\n    return new Promise((function ($return, $error) {\r\n        {\r\n            var _fn, $iterator_fn_8 = [callbacks[Symbol.iterator]()];\r\n            var $Loop_9_trampoline;\r\n            return ($Loop_9_trampoline = (function (q) {\r\n                var this$1 = this;\r\n\r\n                while (q) {\r\n                    if (q.then) \r\n                        { return void q.then($Loop_9_trampoline, $error); }\r\n                    try {\r\n                        if (q.pop) \r\n                            { if (q.length) \r\n                            { return q.pop() ? $Loop_9_exit.call(this$1) : q; }\r\n                         else \r\n                            { q = $Loop_9; } }\r\n                         else \r\n                            { q = q.call(this$1); }\r\n                    } catch (_exception) {\r\n                        return $error(_exception);\r\n                    }\r\n                }\r\n            }).bind(this))($Loop_9);\r\n            function $Loop_9() {\r\n                if (!($iterator_fn_8[1] = $iterator_fn_8[0].next()).done && ((_fn = $iterator_fn_8[1].value) || true)) {\r\n                    return promisify(_fn).apply(void 0, args).then((function ($await_19) {\r\n                        try {\r\n                            if ($await_19 === false) {\r\n                                return $return(false);\r\n                            }\r\n                            return $Loop_9;\r\n                        } catch ($boundEx) {\r\n                            return $error($boundEx);\r\n                        }\r\n                    }).bind(this), $error);\r\n                } else \r\n                    { return [1]; }\r\n            }\r\n            \r\n        }\r\n        function $Loop_9_exit() {\r\n            return $return();\r\n        }\r\n        \r\n    }).bind(this));\r\n}\r\n\r\nfunction isGenerator(x) {\r\n    return x.constructor.name === 'GeneratorFunction';\r\n}\r\n\r\nfunction isThenable(x) {\r\n    return !isUndefined(x) && isFunction(x.then);\r\n}\r\n\r\nfunction generatorify(fn) {\r\n    return isGenerator(fn) ? fn : function () {\r\n        var args = [], len = arguments.length;\r\n        while ( len-- ) args[ len ] = arguments[ len ];\r\n\r\n        var count = 1, ret;\r\n        return {\r\n            next: function next() {\r\n                return new Promise((function ($return, $error) {\r\n                    switch (count++) {\r\n                        case 1:\r\n                            return promisify(fn).apply(void 0, args).then((function ($await_20) {\r\n                                try {\r\n                                    ret = $await_20 || false;\r\n                                    return new Promise((function ($return, $error) {\r\n                                        if (ret && ret.beforeRender) {\r\n                                            return promisify(ret.beforeRender)().then($return, $error);\r\n                                        }\r\n                                        return $return(ret);\r\n                                    }).bind(this)).then($return, $error);\r\n                                } catch ($boundEx) {\r\n                                    return $error($boundEx);\r\n                                }\r\n                            }).bind(this), $error);\r\n                        case 2:\r\n                            return new Promise((function ($return, $error) {\r\n                                var $logicalAnd_1;\r\n                                if ($logicalAnd_1 = ret) {\r\n                                    return promisify(ret.afterRender)().then((function ($await_23) {\r\n                                        try {\r\n                                            $logicalAnd_1 = $await_23;\r\n                                            return $If_13.call(this);\r\n                                        } catch ($boundEx) {\r\n                                            return $error($boundEx);\r\n                                        }\r\n                                    }).bind(this), $error);\r\n                                }\r\n                                function $If_13() {\r\n                                    return $return($logicalAnd_1);\r\n                                }\r\n                                \r\n                                return $If_13.call(this);\r\n                            }).bind(this)).then($return, $error);\r\n                        case 3:\r\n                            return new Promise((function ($return, $error) {\r\n                                var $logicalAnd_2;\r\n                                if ($logicalAnd_2 = ret) {\r\n                                    return promisify(ret.beforeDispose)().then((function ($await_25) {\r\n                                        try {\r\n                                            $logicalAnd_2 = $await_25;\r\n                                            return $If_14.call(this);\r\n                                        } catch ($boundEx) {\r\n                                            return $error($boundEx);\r\n                                        }\r\n                                    }).bind(this), $error);\r\n                                }\r\n                                function $If_14() {\r\n                                    return $return($logicalAnd_2);\r\n                                }\r\n                                \r\n                                return $If_14.call(this);\r\n                            }).bind(this)).then($return, $error);\r\n                        case 4:\r\n                            return new Promise((function ($return, $error) {\r\n                                var $logicalAnd_3;\r\n                                if ($logicalAnd_3 = ret) {\r\n                                    return promisify(ret.afterDispose)().then((function ($await_27) {\r\n                                        try {\r\n                                            $logicalAnd_3 = $await_27;\r\n                                            return $If_15.call(this);\r\n                                        } catch ($boundEx) {\r\n                                            return $error($boundEx);\r\n                                        }\r\n                                    }).bind(this), $error);\r\n                                }\r\n                                function $If_15() {\r\n                                    return $return($logicalAnd_3);\r\n                                }\r\n                                \r\n                                return $If_15.call(this);\r\n                            }).bind(this)).then($return, $error);\r\n                    }\r\n                    return $return();\r\n                }).bind(this));\r\n            }\r\n        };\r\n    };\r\n}\r\n\r\nfunction promisify(_fn) {\r\n    var this$1 = this;\r\n    if ( _fn === void 0 ) _fn = function () {};\r\n\r\n    return function () {\r\n        var args = [], len = arguments.length;\r\n        while ( len-- ) args[ len ] = arguments[ len ];\r\n\r\n        return new Promise((function ($return, $error) {\r\n        var fn, ret;\r\n        fn = (function () { return _fn.length === args.length + 1 ? new Promise(function (r) {\r\n            _fn.apply(void 0, args.concat( [r] ));\r\n        }) : _fn.apply(void 0, args); });\r\n        ret = fn();\r\n        return new Promise((function ($return, $error) {\r\n            if (isThenable(ret)) {\r\n                return ret.then($return, $error);\r\n            }\r\n            return $return(ret);\r\n        }).bind(this)).then($return, $error);\r\n    }).bind(this$1));\r\n    };\r\n}\r\n\r\nvar Context = function Context(params) {\r\n    Object.assign(this, params);\r\n    this.fullPath = this.router.base + this.pathname;\r\n    this.canonicalPath = this.fullPath.replace(new RegExp(this.router.$root.base, 'i'), '');\r\n    this._queue = [];\r\n    this._beforeNavigateCallbacks = [];\r\n    this._afterRenderCallbacks = [];\r\n    this._beforeDisposeCallbacks = [];\r\n    this._afterDisposeCallbacks = [];\r\n};\r\n\r\nvar prototypeAccessors$1 = { $parent: {},$parents: {},$child: {},$children: {},element: {} };\r\nContext.prototype.addBeforeNavigateCallback = function addBeforeNavigateCallback (cb) {\r\n    this._beforeNavigateCallbacks.unshift(cb);\r\n};\r\nprototypeAccessors$1.$parent.get = function () {\r\n    return this.router.isRoot ? undefined : this.router.$parent.ctx;\r\n};\r\nprototypeAccessors$1.$parents.get = function () {\r\n    return this.router.$parents.map(function (r) { return r.ctx; });\r\n};\r\nprototypeAccessors$1.$child.get = function () {\r\n    return isUndefined(this.router.$child) ? undefined : this.router.$child.ctx;\r\n};\r\nprototypeAccessors$1.$children.get = function () {\r\n    return this.router.$children.map(function (r) { return r.ctx; });\r\n};\r\nprototypeAccessors$1.element.get = function () {\r\n    return document.getElementsByClassName('ko-component-router-view')[this.router.depth];\r\n};\r\nContext.prototype.runBeforeNavigateCallbacks = function runBeforeNavigateCallbacks () {\r\n    return new Promise((function ($return, $error) {\r\n        var ctx, callbacks;\r\n        ctx = this;\r\n        callbacks = [];\r\n        while (ctx) {\r\n            callbacks = ctx._beforeNavigateCallbacks.concat( callbacks);\r\n            ctx = ctx.$child;\r\n        }\r\n        return sequence(callbacks).then($return, $error);\r\n    }).bind(this));\r\n};\r\nContext.prototype.queue = function queue (promise) {\r\n    this._queue.push(promise);\r\n};\r\nContext.prototype.flushQueue = function flushQueue () {\r\n    return new Promise((function ($return, $error) {\r\n            var this$1 = this;\r\n\r\n        return $return(Promise.all(this._queue).then(function () { return this$1._queue = []; }));\r\n    }).bind(this));\r\n};\r\nContext.prototype.runBeforeRender = function runBeforeRender () {\r\n    return new Promise((function ($return, $error) {\r\n        var appBeforeRender, appDownstream, routeBeforeRender, routeDownstream;\r\n        var assign;\r\n            (assign = runMiddleware(Router$1.middleware, this), appBeforeRender = assign[0], appDownstream = assign[1]);\r\n        this._afterRenderCallbacks.push(appDownstream);\r\n        this._beforeDisposeCallbacks.push(appDownstream);\r\n        this._afterDisposeCallbacks.push(appDownstream);\r\n        return appBeforeRender.then((function ($await_3) {\r\n            try {\r\n                var assign;\r\n                    (assign = runMiddleware(this.route.middleware, this), routeBeforeRender = assign[0], routeDownstream = assign[1]);\r\n                this._afterRenderCallbacks.push(routeDownstream);\r\n                this._beforeDisposeCallbacks.unshift(routeDownstream);\r\n                this._afterDisposeCallbacks.unshift(routeDownstream);\r\n                return routeBeforeRender.then((function ($await_4) {\r\n                    try {\r\n                        return this.flushQueue().then((function ($await_5) {\r\n                            try {\r\n                                return $return();\r\n                            } catch ($boundEx) {\r\n                                return $error($boundEx);\r\n                            }\r\n                        }).bind(this), $error);\r\n                    } catch ($boundEx) {\r\n                        return $error($boundEx);\r\n                    }\r\n                }).bind(this), $error);\r\n            } catch ($boundEx) {\r\n                return $error($boundEx);\r\n            }\r\n        }).bind(this), $error);\r\n    }).bind(this));\r\n};\r\nContext.prototype.runAfterRender = function runAfterRender () {\r\n    return new Promise((function ($return, $error) {\r\n        return sequence(this._afterRenderCallbacks).then((function ($await_6) {\r\n            try {\r\n                return this.flushQueue().then((function ($await_7) {\r\n                    try {\r\n                        return $return();\r\n                    } catch ($boundEx) {\r\n                        return $error($boundEx);\r\n                    }\r\n                }).bind(this), $error);\r\n            } catch ($boundEx) {\r\n                return $error($boundEx);\r\n            }\r\n        }).bind(this), $error);\r\n    }).bind(this));\r\n};\r\nContext.prototype.runBeforeDispose = function runBeforeDispose () {\r\n    return new Promise((function ($return, $error) {\r\n        if (this.$child) {\r\n            return this.$child.runBeforeDispose().then((function ($await_8) {\r\n                try {\r\n                    return $If_1.call(this);\r\n                } catch ($boundEx) {\r\n                    return $error($boundEx);\r\n                }\r\n            }).bind(this), $error);\r\n        }\r\n        function $If_1() {\r\n            return sequence(this._beforeDisposeCallbacks).then((function ($await_9) {\r\n                try {\r\n                    return this.flushQueue().then((function ($await_10) {\r\n                        try {\r\n                            return $return();\r\n                        } catch ($boundEx) {\r\n                            return $error($boundEx);\r\n                        }\r\n                    }).bind(this), $error);\r\n                } catch ($boundEx) {\r\n                    return $error($boundEx);\r\n                }\r\n            }).bind(this), $error);\r\n        }\r\n            \r\n        return $If_1.call(this);\r\n    }).bind(this));\r\n};\r\nContext.prototype.runAfterDispose = function runAfterDispose () {\r\n    return new Promise((function ($return, $error) {\r\n        return sequence(this._afterDisposeCallbacks).then((function ($await_11) {\r\n            try {\r\n                return this.flushQueue().then((function ($await_12) {\r\n                    try {\r\n                        return $return();\r\n                    } catch ($boundEx) {\r\n                        return $error($boundEx);\r\n                    }\r\n                }).bind(this), $error);\r\n            } catch ($boundEx) {\r\n                return $error($boundEx);\r\n            }\r\n        }).bind(this), $error);\r\n    }).bind(this));\r\n};\r\n\r\nObject.defineProperties( Context.prototype, prototypeAccessors$1 );\r\n\r\nvar index$4 = Array.isArray || function (arr) {\r\n  return Object.prototype.toString.call(arr) == '[object Array]';\r\n};\r\n\r\nvar isarray = index$4;\r\n\r\n/**\r\n * Expose `pathToRegexp`.\r\n */\r\nvar index$3 = pathToRegexp;\r\nvar parse_1 = parse;\r\nvar compile_1 = compile;\r\nvar tokensToFunction_1 = tokensToFunction;\r\nvar tokensToRegExp_1 = tokensToRegExp;\r\n\r\n/**\r\n * The main path matching regexp utility.\r\n *\r\n * @type {RegExp}\r\n */\r\nvar PATH_REGEXP = new RegExp([\r\n  // Match escaped characters that would otherwise appear in future matches.\r\n  // This allows the user to escape special characters that won't transform.\r\n  '(\\\\\\\\.)',\r\n  // Match Express-style parameters and un-named parameters with a prefix\r\n  // and optional suffixes. Matches appear as:\r\n  //\r\n  // \"/:test(\\\\d+)?\" => [\"/\", \"test\", \"\\d+\", undefined, \"?\", undefined]\r\n  // \"/route(\\\\d+)\"  => [undefined, undefined, undefined, \"\\d+\", undefined, undefined]\r\n  // \"/*\"            => [\"/\", undefined, undefined, undefined, undefined, \"*\"]\r\n  '([\\\\/.])?(?:(?:\\\\:(\\\\w+)(?:\\\\(((?:\\\\\\\\.|[^\\\\\\\\()])+)\\\\))?|\\\\(((?:\\\\\\\\.|[^\\\\\\\\()])+)\\\\))([+*?])?|(\\\\*))'\r\n].join('|'), 'g');\r\n\r\n/**\r\n * Parse a string for the raw tokens.\r\n *\r\n * @param  {string}  str\r\n * @param  {Object=} options\r\n * @return {!Array}\r\n */\r\nfunction parse (str, options) {\r\n  var tokens = [];\r\n  var key = 0;\r\n  var index = 0;\r\n  var path = '';\r\n  var defaultDelimiter = options && options.delimiter || '/';\r\n  var res;\r\n\r\n  while ((res = PATH_REGEXP.exec(str)) != null) {\r\n    var m = res[0];\r\n    var escaped = res[1];\r\n    var offset = res.index;\r\n    path += str.slice(index, offset);\r\n    index = offset + m.length;\r\n\r\n    // Ignore already escaped sequences.\r\n    if (escaped) {\r\n      path += escaped[1];\r\n      continue\r\n    }\r\n\r\n    var next = str[index];\r\n    var prefix = res[2];\r\n    var name = res[3];\r\n    var capture = res[4];\r\n    var group = res[5];\r\n    var modifier = res[6];\r\n    var asterisk = res[7];\r\n\r\n    // Push the current path onto the tokens.\r\n    if (path) {\r\n      tokens.push(path);\r\n      path = '';\r\n    }\r\n\r\n    var partial = prefix != null && next != null && next !== prefix;\r\n    var repeat = modifier === '+' || modifier === '*';\r\n    var optional = modifier === '?' || modifier === '*';\r\n    var delimiter = res[2] || defaultDelimiter;\r\n    var pattern = capture || group;\r\n\r\n    tokens.push({\r\n      name: name || key++,\r\n      prefix: prefix || '',\r\n      delimiter: delimiter,\r\n      optional: optional,\r\n      repeat: repeat,\r\n      partial: partial,\r\n      asterisk: !!asterisk,\r\n      pattern: pattern ? escapeGroup(pattern) : (asterisk ? '.*' : '[^' + escapeString(delimiter) + ']+?')\r\n    });\r\n  }\r\n\r\n  // Match any characters still remaining.\r\n  if (index < str.length) {\r\n    path += str.substr(index);\r\n  }\r\n\r\n  // If the path exists, push it onto the end.\r\n  if (path) {\r\n    tokens.push(path);\r\n  }\r\n\r\n  return tokens\r\n}\r\n\r\n/**\r\n * Compile a string to a template function for the path.\r\n *\r\n * @param  {string}             str\r\n * @param  {Object=}            options\r\n * @return {!function(Object=, Object=)}\r\n */\r\nfunction compile (str, options) {\r\n  return tokensToFunction(parse(str, options))\r\n}\r\n\r\n/**\r\n * Prettier encoding of URI path segments.\r\n *\r\n * @param  {string}\r\n * @return {string}\r\n */\r\nfunction encodeURIComponentPretty (str) {\r\n  return encodeURI(str).replace(/[\\/?#]/g, function (c) {\r\n    return '%' + c.charCodeAt(0).toString(16).toUpperCase()\r\n  })\r\n}\r\n\r\n/**\r\n * Encode the asterisk parameter. Similar to `pretty`, but allows slashes.\r\n *\r\n * @param  {string}\r\n * @return {string}\r\n */\r\nfunction encodeAsterisk (str) {\r\n  return encodeURI(str).replace(/[?#]/g, function (c) {\r\n    return '%' + c.charCodeAt(0).toString(16).toUpperCase()\r\n  })\r\n}\r\n\r\n/**\r\n * Expose a method for transforming tokens into the path function.\r\n */\r\nfunction tokensToFunction (tokens) {\r\n  // Compile all the tokens into regexps.\r\n  var matches = new Array(tokens.length);\r\n\r\n  // Compile all the patterns before compilation.\r\n  for (var i = 0; i < tokens.length; i++) {\r\n    if (typeof tokens[i] === 'object') {\r\n      matches[i] = new RegExp('^(?:' + tokens[i].pattern + ')$');\r\n    }\r\n  }\r\n\r\n  return function (obj, opts) {\r\n    var path = '';\r\n    var data = obj || {};\r\n    var options = opts || {};\r\n    var encode = options.pretty ? encodeURIComponentPretty : encodeURIComponent;\r\n\r\n    for (var i = 0; i < tokens.length; i++) {\r\n      var token = tokens[i];\r\n\r\n      if (typeof token === 'string') {\r\n        path += token;\r\n\r\n        continue\r\n      }\r\n\r\n      var value = data[token.name];\r\n      var segment;\r\n\r\n      if (value == null) {\r\n        if (token.optional) {\r\n          // Prepend partial segment prefixes.\r\n          if (token.partial) {\r\n            path += token.prefix;\r\n          }\r\n\r\n          continue\r\n        } else {\r\n          throw new TypeError('Expected \"' + token.name + '\" to be defined')\r\n        }\r\n      }\r\n\r\n      if (isarray(value)) {\r\n        if (!token.repeat) {\r\n          throw new TypeError('Expected \"' + token.name + '\" to not repeat, but received `' + JSON.stringify(value) + '`')\r\n        }\r\n\r\n        if (value.length === 0) {\r\n          if (token.optional) {\r\n            continue\r\n          } else {\r\n            throw new TypeError('Expected \"' + token.name + '\" to not be empty')\r\n          }\r\n        }\r\n\r\n        for (var j = 0; j < value.length; j++) {\r\n          segment = encode(value[j]);\r\n\r\n          if (!matches[i].test(segment)) {\r\n            throw new TypeError('Expected all \"' + token.name + '\" to match \"' + token.pattern + '\", but received `' + JSON.stringify(segment) + '`')\r\n          }\r\n\r\n          path += (j === 0 ? token.prefix : token.delimiter) + segment;\r\n        }\r\n\r\n        continue\r\n      }\r\n\r\n      segment = token.asterisk ? encodeAsterisk(value) : encode(value);\r\n\r\n      if (!matches[i].test(segment)) {\r\n        throw new TypeError('Expected \"' + token.name + '\" to match \"' + token.pattern + '\", but received \"' + segment + '\"')\r\n      }\r\n\r\n      path += token.prefix + segment;\r\n    }\r\n\r\n    return path\r\n  }\r\n}\r\n\r\n/**\r\n * Escape a regular expression string.\r\n *\r\n * @param  {string} str\r\n * @return {string}\r\n */\r\nfunction escapeString (str) {\r\n  return str.replace(/([.+*?=^!:${}()[\\]|\\/\\\\])/g, '\\\\$1')\r\n}\r\n\r\n/**\r\n * Escape the capturing group by escaping special characters and meaning.\r\n *\r\n * @param  {string} group\r\n * @return {string}\r\n */\r\nfunction escapeGroup (group) {\r\n  return group.replace(/([=!:$\\/()])/g, '\\\\$1')\r\n}\r\n\r\n/**\r\n * Attach the keys as a property of the regexp.\r\n *\r\n * @param  {!RegExp} re\r\n * @param  {Array}   keys\r\n * @return {!RegExp}\r\n */\r\nfunction attachKeys (re, keys) {\r\n  re.keys = keys;\r\n  return re\r\n}\r\n\r\n/**\r\n * Get the flags for a regexp from the options.\r\n *\r\n * @param  {Object} options\r\n * @return {string}\r\n */\r\nfunction flags (options) {\r\n  return options.sensitive ? '' : 'i'\r\n}\r\n\r\n/**\r\n * Pull out keys from a regexp.\r\n *\r\n * @param  {!RegExp} path\r\n * @param  {!Array}  keys\r\n * @return {!RegExp}\r\n */\r\nfunction regexpToRegexp (path, keys) {\r\n  // Use a negative lookahead to match only capturing groups.\r\n  var groups = path.source.match(/\\((?!\\?)/g);\r\n\r\n  if (groups) {\r\n    for (var i = 0; i < groups.length; i++) {\r\n      keys.push({\r\n        name: i,\r\n        prefix: null,\r\n        delimiter: null,\r\n        optional: false,\r\n        repeat: false,\r\n        partial: false,\r\n        asterisk: false,\r\n        pattern: null\r\n      });\r\n    }\r\n  }\r\n\r\n  return attachKeys(path, keys)\r\n}\r\n\r\n/**\r\n * Transform an array into a regexp.\r\n *\r\n * @param  {!Array}  path\r\n * @param  {Array}   keys\r\n * @param  {!Object} options\r\n * @return {!RegExp}\r\n */\r\nfunction arrayToRegexp (path, keys, options) {\r\n  var parts = [];\r\n\r\n  for (var i = 0; i < path.length; i++) {\r\n    parts.push(pathToRegexp(path[i], keys, options).source);\r\n  }\r\n\r\n  var regexp = new RegExp('(?:' + parts.join('|') + ')', flags(options));\r\n\r\n  return attachKeys(regexp, keys)\r\n}\r\n\r\n/**\r\n * Create a path regexp from string input.\r\n *\r\n * @param  {string}  path\r\n * @param  {!Array}  keys\r\n * @param  {!Object} options\r\n * @return {!RegExp}\r\n */\r\nfunction stringToRegexp (path, keys, options) {\r\n  return tokensToRegExp(parse(path, options), keys, options)\r\n}\r\n\r\n/**\r\n * Expose a function for taking tokens and returning a RegExp.\r\n *\r\n * @param  {!Array}          tokens\r\n * @param  {(Array|Object)=} keys\r\n * @param  {Object=}         options\r\n * @return {!RegExp}\r\n */\r\nfunction tokensToRegExp (tokens, keys, options) {\r\n  if (!isarray(keys)) {\r\n    options = /** @type {!Object} */ (keys || options);\r\n    keys = [];\r\n  }\r\n\r\n  options = options || {};\r\n\r\n  var strict = options.strict;\r\n  var end = options.end !== false;\r\n  var route = '';\r\n\r\n  // Iterate over the tokens and create our regexp string.\r\n  for (var i = 0; i < tokens.length; i++) {\r\n    var token = tokens[i];\r\n\r\n    if (typeof token === 'string') {\r\n      route += escapeString(token);\r\n    } else {\r\n      var prefix = escapeString(token.prefix);\r\n      var capture = '(?:' + token.pattern + ')';\r\n\r\n      keys.push(token);\r\n\r\n      if (token.repeat) {\r\n        capture += '(?:' + prefix + capture + ')*';\r\n      }\r\n\r\n      if (token.optional) {\r\n        if (!token.partial) {\r\n          capture = '(?:' + prefix + '(' + capture + '))?';\r\n        } else {\r\n          capture = prefix + '(' + capture + ')?';\r\n        }\r\n      } else {\r\n        capture = prefix + '(' + capture + ')';\r\n      }\r\n\r\n      route += capture;\r\n    }\r\n  }\r\n\r\n  var delimiter = escapeString(options.delimiter || '/');\r\n  var endsWithDelimiter = route.slice(-delimiter.length) === delimiter;\r\n\r\n  // In non-strict mode we allow a slash at the end of match. If the path to\r\n  // match already ends with a slash, we remove it for consistency. The slash\r\n  // is valid at the end of a path match, not in the middle. This is important\r\n  // in non-ending mode, where \"/test/\" shouldn't match \"/test//route\".\r\n  if (!strict) {\r\n    route = (endsWithDelimiter ? route.slice(0, -delimiter.length) : route) + '(?:' + delimiter + '(?=$))?';\r\n  }\r\n\r\n  if (end) {\r\n    route += '$';\r\n  } else {\r\n    // In non-ending mode, we need the capturing groups to match as much as\r\n    // possible by using a positive lookahead to the end or next path segment.\r\n    route += strict && endsWithDelimiter ? '' : '(?=' + delimiter + '|$)';\r\n  }\r\n\r\n  return attachKeys(new RegExp('^' + route, flags(options)), keys)\r\n}\r\n\r\n/**\r\n * Normalize the given path string, returning a regular expression.\r\n *\r\n * An empty array can be passed in for the keys, which will hold the\r\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\r\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\r\n *\r\n * @param  {(string|RegExp|Array)} path\r\n * @param  {(Array|Object)=}       keys\r\n * @param  {Object=}               options\r\n * @return {!RegExp}\r\n */\r\nfunction pathToRegexp (path, keys, options) {\r\n  if (!isarray(keys)) {\r\n    options = /** @type {!Object} */ (keys || options);\r\n    keys = [];\r\n  }\r\n\r\n  options = options || {};\r\n\r\n  if (path instanceof RegExp) {\r\n    return regexpToRegexp(path, /** @type {!Array} */ (keys))\r\n  }\r\n\r\n  if (isarray(path)) {\r\n    return arrayToRegexp(/** @type {!Array} */ (path), /** @type {!Array} */ (keys), options)\r\n  }\r\n\r\n  return stringToRegexp(/** @type {string} */ (path), /** @type {!Array} */ (keys), options)\r\n}\r\n\r\nindex$3.parse = parse_1;\r\nindex$3.compile = compile_1;\r\nindex$3.tokensToFunction = tokensToFunction_1;\r\nindex$3.tokensToRegExp = tokensToRegExp_1;\r\n\r\nvar Route = function Route(path, middleware) {\r\n    var this$1 = this;\r\n\r\n    this.middleware = flatMap(isArray(middleware) ? middleware : [middleware], function (m) {\r\n        var pluginMiddleware = Router$1.plugins.reduce(function (ms, p) {\r\n            var _m = p(m);\r\n            return _m ? ms.concat(isArray(_m) ? _m : [_m]) : ms;\r\n        }, []);\r\n        return pluginMiddleware.length > 0 ? pluginMiddleware : m;\r\n    }).reduce(function (ms, m) {\r\n        if (isString(m)) {\r\n            this$1.component = m;\r\n        } else if (isPlainObject(m)) {\r\n            path = path.replace(/\\/?!?$/, '/!');\r\n            this$1.children = Object.entries(m).map(function (ref) {\r\n                var r = ref[0];\r\n                var m = ref[1];\r\n\r\n                return new Route(r, m);\r\n            });\r\n            if (!this$1.component) {\r\n                this$1.component = 'ko-component-router';\r\n            }\r\n        } else if (isFunction(m)) {\r\n            ms.push(m);\r\n        }\r\n        return ms;\r\n    }, []);\r\n    if (path[path.length - 1] === '!') {\r\n        path = path.replace('!', ':__child_path__(.*)?');\r\n    } else {\r\n        path = path.replace(/\\(?\\*\\)?/, '(.*)');\r\n    }\r\n    this.path = path;\r\n    this._keys = [];\r\n    this._regexp = index$3(path, this._keys);\r\n};\r\nRoute.prototype.matches = function matches (path) {\r\n        var this$1 = this;\r\n\r\n    var matches = this._regexp.exec(path);\r\n    if (matches === null) {\r\n        return false;\r\n    }\r\n    if (this.children) {\r\n        for (var i = 0, list = this$1.children; i < list.length; i += 1) {\r\n            var childRoute = list[i];\r\n\r\n                var childPath = '/' + (matches[matches.length - 1] || '');\r\n            if (childRoute.matches(childPath)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    return true;\r\n};\r\nRoute.prototype.parse = function parse$$1 (path) {\r\n        var this$1 = this;\r\n\r\n    var childPath;\r\n    var params = {};\r\n    var matches = this._regexp.exec(path);\r\n    for (var i = 1, len = matches.length;i < len; ++i) {\r\n        var k = this$1._keys[i - 1];\r\n        var v = matches[i] || '';\r\n        if (k.name === '__child_path__') {\r\n            childPath = '/' + v;\r\n        } else {\r\n            params[k.name] = v;\r\n        }\r\n    }\r\n    return [params,path.replace(new RegExp(childPath + '$'), ''),childPath];\r\n};\r\nRoute.createRoutes = function createRoutes (routes) {\r\n    return Object.entries(routes).map(function (ref) {\r\n            var r = ref[0];\r\n            var m = ref[1];\r\n\r\n            return new Route(r, m);\r\n        });\r\n};\r\n\r\nvar events = {\r\n    click: document.ontouchstart ? 'touchstart' : 'click',\r\n    popstate: 'popstate'\r\n};\r\nvar onInit = [];\r\nvar routers = [];\r\nvar Router$1 = function Router(params) {\r\n    var this$1 = this;\r\n\r\n    this.component = ko.observable();\r\n    this.isNavigating = ko.observable(true);\r\n    this.routes = Route.createRoutes(params.routes || {});\r\n    Router.link(this);\r\n    if (this.isRoot) {\r\n        Router.setConfig(params);\r\n        (ref = this.routes).push.apply(ref, Route.createRoutes(Router.routes));\r\n        document.addEventListener(events.click, Router.onclick);\r\n        window.addEventListener(events.popstate, Router.onpopstate);\r\n    } else if (this.$parent.ctx.route.children) {\r\n        (ref$1 = this.routes).push.apply(ref$1, this.$parent.ctx.route.children);\r\n    }\r\n    this.passthrough = Object.entries(params).reduce(function (accum, ref) {\r\n        var k = ref[0];\r\n        var v = ref[1];\r\n\r\n        return k === 'base' || k === 'hashbang' || k === 'routes' ? accum : Object.assign(accum, ( obj = {}, obj[k] = v, obj ))\r\n        var obj;\r\n    }, {});\r\n    this.update(this.getPathFromLocation(), false).then(function () { return onInit.forEach(function (r) { return r(this$1); }); });\r\n    var ref;\r\n    var ref$1;\r\n};\r\n\r\nvar prototypeAccessors = { base: {},$parent: {},$parents: {},$child: {},$children: {} };\r\nvar staticAccessors = { head: {},tail: {},initialized: {} };\r\nprototypeAccessors.base.get = function () {\r\n    return this.isRoot ? Router$1.config.base + (Router$1.config.hashbang ? '/#!' : '') : this.$parent.base + this.$parent.ctx.pathname;\r\n};\r\nprototypeAccessors.$parent.get = function () {\r\n    return routers[this.depth - 1];\r\n};\r\nprototypeAccessors.$parents.get = function () {\r\n    return routers.slice(0, this.depth).reverse();\r\n};\r\nprototypeAccessors.$child.get = function () {\r\n    return routers[this.depth + 1];\r\n};\r\nprototypeAccessors.$children.get = function () {\r\n    return routers.slice(this.depth + 1);\r\n};\r\nRouter$1.prototype.update = function update (url, args) {\r\n    return new Promise((function ($return, $error) {\r\n        var fromCtx, search, hash, path, route, params, pathname, childPath, shouldNavigate, toCtx, fromCtxChildren;\r\n        fromCtx = this.ctx;\r\n        if (isBool(args)) {\r\n            args = {\r\n                push: args\r\n            };\r\n        } else if (isUndefined(args)) {\r\n            args = {};\r\n        }\r\n        if (isUndefined(args.push)) {\r\n            args.push = true;\r\n        }\r\n        if (isUndefined(args.with)) {\r\n            args.with = {};\r\n        }\r\n        var assign;\r\n            ((assign = Router$1.parseUrl(url), search = assign.search, hash = assign.hash));\r\n        path = Router$1.getPath(url);\r\n        route = this.resolveRoute(path);\r\n        if (!route) {\r\n            return $return(false);\r\n        }\r\n        var assign$1;\r\n            (assign$1 = route.parse(path), params = assign$1[0], pathname = assign$1[1], childPath = assign$1[2]);\r\n        if (fromCtx && fromCtx.pathname === pathname && !args.force) {\r\n            if (this.$child) {\r\n                return this.$child.update(childPath + search + hash, args).then($return, $error);\r\n            } else {\r\n                return $return(false);\r\n            }\r\n            return $If_1.call(this);\r\n        }\r\n        function $If_1() {\r\n            if (fromCtx) {\r\n                return fromCtx.runBeforeNavigateCallbacks().then((function ($await_10) {\r\n                    try {\r\n                        shouldNavigate = $await_10;\r\n                        if (shouldNavigate === false) {\r\n                            return $return(false);\r\n                        }\r\n                        this.isNavigating(true);\r\n                        return $If_2.call(this);\r\n                    } catch ($boundEx) {\r\n                        return $error($boundEx);\r\n                    }\r\n                }).bind(this), $error);\r\n            }\r\n            function $If_2() {\r\n                history[args.push ? 'pushState' : 'replaceState'](history.state, document.title, this.base + path + search + hash);\r\n                toCtx = new Context(Object.assign({}, args.with, this.passthrough, {\r\n                    router: this,\r\n                    params: params,\r\n                    route: route,\r\n                    path: path,\r\n                    pathname: pathname\r\n                }));\r\n                if (fromCtx) {\r\n                    return fromCtx.runBeforeDispose().then((function ($await_11) {\r\n                        try {\r\n                            return $If_3.call(this);\r\n                        } catch ($boundEx) {\r\n                            return $error($boundEx);\r\n                        }\r\n                    }).bind(this), $error);\r\n                }\r\n                function $If_3() {\r\n                    fromCtxChildren = fromCtx && fromCtx.$children.reverse();\r\n                    return toCtx.runBeforeRender().then((function ($await_12) {\r\n                        try {\r\n                            this.ctx = toCtx;\r\n                            this.component(false);\r\n                            ko.tasks.runEarly();\r\n                            this.component(this.ctx.route.component);\r\n                            ko.tasks.runEarly();\r\n                            if (fromCtx) {\r\n                                {\r\n                                    var fromCtxChild, $iterator_fromCtxChild_5 = [fromCtxChildren[Symbol.iterator]()];\r\n                                    var $Loop_6_trampoline;\r\n                                    return ($Loop_6_trampoline = (function (q) {\r\n                                            var this$1 = this;\r\n\r\n                                        while (q) {\r\n                                            if (q.then) \r\n                                                { return void q.then($Loop_6_trampoline, $error); }\r\n                                            try {\r\n                                                if (q.pop) \r\n                                                    { if (q.length) \r\n                                                    { return q.pop() ? $Loop_6_exit.call(this$1) : q; }\r\n                                                 else \r\n                                                    { q = $Loop_6; } }\r\n                                                 else \r\n                                                    { q = q.call(this$1); }\r\n                                            } catch (_exception) {\r\n                                                return $error(_exception);\r\n                                            }\r\n                                        }\r\n                                    }).bind(this))($Loop_6);\r\n                                    function $Loop_6() {\r\n                                        if (!($iterator_fromCtxChild_5[1] = $iterator_fromCtxChild_5[0].next()).done && ((fromCtxChild = $iterator_fromCtxChild_5[1].value) || true)) {\r\n                                            return fromCtxChild.runAfterDispose().then((function ($await_13) {\r\n                                                try {\r\n                                                    return $Loop_6;\r\n                                                } catch ($boundEx) {\r\n                                                    return $error($boundEx);\r\n                                                }\r\n                                            }).bind(this), $error);\r\n                                        } else \r\n                                            { return [1]; }\r\n                                    }\r\n                                        \r\n                                }\r\n                                function $Loop_6_exit() {\r\n                                    return fromCtx.runAfterDispose().then((function ($await_14) {\r\n                                        try {\r\n                                            return $If_4.call(this);\r\n                                        } catch ($boundEx) {\r\n                                            return $error($boundEx);\r\n                                        }\r\n                                    }).bind(this), $error);\r\n                                }\r\n                                    \r\n                            }\r\n                            function $If_4() {\r\n                                return toCtx.runAfterRender().then((function ($await_15) {\r\n                                    try {\r\n                                        this.isNavigating(false);\r\n                                        return $return(true);\r\n                                    } catch ($boundEx) {\r\n                                        return $error($boundEx);\r\n                                    }\r\n                                }).bind(this), $error);\r\n                            }\r\n                                \r\n                            return $If_4.call(this);\r\n                        } catch ($boundEx) {\r\n                            return $error($boundEx);\r\n                        }\r\n                    }).bind(this), $error);\r\n                }\r\n                    \r\n                return $If_3.call(this);\r\n            }\r\n                \r\n            return $If_2.call(this);\r\n        }\r\n            \r\n        return $If_1.call(this);\r\n    }).bind(this));\r\n};\r\nRouter$1.prototype.resolveRoute = function resolveRoute (path) {\r\n        var this$1 = this;\r\n\r\n    var matchingRouteWithFewestDynamicSegments;\r\n    var fewestMatchingSegments = Infinity;\r\n    for (var rn in this$1.routes) {\r\n        var r = this$1.routes[rn];\r\n        if (r.matches(path)) {\r\n            if (r._keys.length === 0) {\r\n                return r;\r\n            } else if (fewestMatchingSegments === Infinity || r._keys.length < fewestMatchingSegments && r._keys[0].pattern !== '.*') {\r\n                fewestMatchingSegments = r._keys.length;\r\n                matchingRouteWithFewestDynamicSegments = r;\r\n            }\r\n        }\r\n    }\r\n    return matchingRouteWithFewestDynamicSegments;\r\n};\r\nRouter$1.prototype.getPathFromLocation = function getPathFromLocation () {\r\n    var path = location.pathname + location.search + location.hash;\r\n    var baseWithOrWithoutHashbangRegexp = this.base.replace('#!', '#?!?');\r\n    return path.replace(new RegExp(baseWithOrWithoutHashbangRegexp, 'i'), '');\r\n};\r\nRouter$1.prototype.dispose = function dispose () {\r\n        var this$1 = this;\r\n\r\n    Router$1.unlink();\r\n    if (this.isRoot) {\r\n        document.removeEventListener(events.click, Router$1.onclick, false);\r\n        window.removeEventListener(events.popstate, Router$1.onpopstate, false);\r\n        this.ctx.runBeforeDispose().then(function () { return this$1.ctx.runAfterDispose(); });\r\n    }\r\n};\r\nRouter$1.setConfig = function setConfig (ref) {\r\n        var base = ref.base;\r\n        var hashbang = ref.hashbang;\r\n\r\n    if (base) {\r\n        Router$1.config.base = base;\r\n    }\r\n    if (hashbang) {\r\n        Router$1.config.hashbang = hashbang;\r\n    }\r\n};\r\nRouter$1.use = function use () {\r\n        var fns = [], len = arguments.length;\r\n        while ( len-- ) fns[ len ] = arguments[ len ];\r\n\r\n    (ref = Router$1.middleware).push.apply(ref, fns);\r\n        var ref;\r\n};\r\nRouter$1.usePlugin = function usePlugin () {\r\n        var fns = [], len = arguments.length;\r\n        while ( len-- ) fns[ len ] = arguments[ len ];\r\n\r\n    (ref = Router$1.plugins).push.apply(ref, fns);\r\n        var ref;\r\n};\r\nRouter$1.useRoutes = function useRoutes (routes) {\r\n    Object.assign(Router$1.routes, routes);\r\n};\r\nRouter$1.get = function get (i) {\r\n    return routers[i];\r\n};\r\nstaticAccessors.head.get = function () {\r\n    return routers[0];\r\n};\r\nstaticAccessors.tail.get = function () {\r\n    return routers[routers.length - 1];\r\n};\r\nstaticAccessors.initialized.get = function () {\r\n    if (routers.length === 0) {\r\n        return new Promise(function (resolve) { return onInit.push(resolve); });\r\n    } else {\r\n        return Promise.resolve(Router$1.head);\r\n    }\r\n};\r\nRouter$1.update = function update () {\r\n        var args = [], len = arguments.length;\r\n        while ( len-- ) args[ len ] = arguments[ len ];\r\n\r\n    return new Promise((function ($return, $error) {\r\n        return (ref = routers[0]).update.apply(ref, args).then($return, $error);\r\n            var ref;\r\n    }).bind(this));\r\n};\r\nRouter$1.link = function link (router) {\r\n    router.depth = routers.length;\r\n    router.isRoot = router.depth === 0;\r\n    routers.push(router);\r\n    router.$root = routers[0];\r\n};\r\nRouter$1.unlink = function unlink () {\r\n    routers.pop();\r\n};\r\nRouter$1.onclick = function onclick (e) {\r\n    if (e.defaultPrevented) {\r\n        return;\r\n    }\r\n    var el = e.target;\r\n    while (el && 'A' !== el.nodeName) {\r\n        el = el.parentNode;\r\n    }\r\n    if (!el || 'A' !== el.nodeName) {\r\n        return;\r\n    }\r\n    var pathname = el.pathname;\r\n        var search = el.search;\r\n        var hash = el.hash; if ( hash === void 0 ) hash = '';\r\n    var path = (pathname + search + hash).replace(new RegExp(routers[0].base, 'i'), '');\r\n    var isValidRoute = Router$1.hasRoute(path);\r\n    var isCrossOrigin = !Router$1.sameOrigin(el.href);\r\n    var isDoubleClick = 1 !== Router$1.which(e);\r\n    var isDownload = el.hasAttribute('download');\r\n    var isEmptyHash = el.getAttribute('href') === '#';\r\n    var isMailto = (el.getAttribute('href') || '').indexOf('mailto:') === 0;\r\n    var hasExternalRel = el.getAttribute('rel') === 'external';\r\n    var hasModifier = e.metaKey || e.ctrlKey || e.shiftKey;\r\n    var hasOtherTarget = el.hasAttribute('target');\r\n    if (!isValidRoute || isCrossOrigin || isDoubleClick || isDownload || isEmptyHash || isMailto || hasExternalRel || hasModifier || hasOtherTarget) {\r\n        return;\r\n    }\r\n    Router$1.update(path);\r\n    e.preventDefault();\r\n};\r\nRouter$1.onpopstate = function onpopstate (e) {\r\n    Router$1.update(routers[0].getPathFromLocation(), false);\r\n    e.preventDefault();\r\n};\r\nRouter$1.canonicalizePath = function canonicalizePath (path) {\r\n    return path.replace(new RegExp('/?#?!?/?'), '/');\r\n};\r\nRouter$1.parseUrl = function parseUrl (url) {\r\n    var parser = document.createElement('a');\r\n    var b = routers[0].base.toLowerCase();\r\n    if (b && url.toLowerCase().indexOf(b) === 0) {\r\n        url = url.replace(new RegExp(b, 'i'), '') || '/';\r\n    }\r\n    parser.href = Router$1.canonicalizePath(url);\r\n    return {\r\n        hash: parser.hash,\r\n        pathname: parser.pathname.charAt(0) === '/' ? parser.pathname : '/' + parser.pathname,\r\n        search: parser.search\r\n    };\r\n};\r\nRouter$1.getPath = function getPath (url) {\r\n    return Router$1.parseUrl(url).pathname;\r\n};\r\nRouter$1.hasRoute = function hasRoute (path) {\r\n    return !isUndefined(Router$1.head.resolveRoute(Router$1.getPath(path)));\r\n};\r\nRouter$1.sameOrigin = function sameOrigin (href) {\r\n    var hostname = location.hostname;\r\n        var port = location.port;\r\n        var protocol = location.protocol;\r\n    var origin = protocol + '//' + hostname;\r\n    if (port) {\r\n        origin += ':' + port;\r\n    }\r\n    return href && href.indexOf(origin) === 0;\r\n};\r\nRouter$1.which = function which (e) {\r\n    e = e || window.event;\r\n    return null === e.which ? e.button : e.which;\r\n};\r\n\r\nObject.defineProperties( Router$1.prototype, prototypeAccessors );\r\nObject.defineProperties( Router$1, staticAccessors );\r\nRouter$1.config = {\r\n    base: '',\r\n    hashbang: false\r\n};\r\nRouter$1.middleware = [];\r\nRouter$1.plugins = [];\r\nRouter$1.routes = {};\r\n\r\nko.bindingHandlers.path = {\r\n    init: function init(el, valueAccessor, allBindings, viewModel, bindingCtx) {\r\n        Router$1.initialized.then(function () {\r\n            ko.tasks.schedule(function () { return ko.applyBindingsToNode(el, {\r\n                attr: {\r\n                    href: ko.pureComputed(function () { return resolveHref(bindingCtx, ko.unwrap(valueAccessor())); })\r\n                },\r\n                css: {\r\n                    'active-path': ko.pureComputed(function () { return isActivePath(bindingCtx, ko.unwrap(valueAccessor())); })\r\n                }\r\n            }); });\r\n        });\r\n    }\r\n};\r\nfunction resolveHref(bindingCtx, _path) {\r\n    var ref = parsePathBinding(bindingCtx, _path);\r\n    var router = ref[0];\r\n    var path = ref[1];\r\n    return router.base + path;\r\n}\r\n\r\nfunction isActivePath(bindingCtx, _path) {\r\n    var ref = parsePathBinding(bindingCtx, _path);\r\n    var router = ref[0];\r\n    var path = ref[1];\r\n    return !router.isNavigating() && (router.ctx.pathname || '/') === '/' + path.split('/')[1];\r\n}\r\n\r\nfunction parsePathBinding(bindingCtx, path) {\r\n    var router = getRouter(bindingCtx);\r\n    if (path.indexOf('//') === 0) {\r\n        path = path.replace('//', '/');\r\n        while (!router.isRoot) {\r\n            router = router.$parent;\r\n        }\r\n    } else {\r\n        if (path.indexOf('./') === 0) {\r\n            path = path.replace('./', '/');\r\n            router = router.$child;\r\n        }\r\n        while (path && path.match(/\\/?\\.\\./i) && !router.isRoot) {\r\n            router = router.$parent;\r\n            path = path.replace(/\\/?\\.\\./i, '');\r\n        }\r\n    }\r\n    return [router,path];\r\n}\r\n\r\nfunction getRouter(bindingCtx) {\r\n    while (!isUndefined(bindingCtx)) {\r\n        if (!isUndefined(bindingCtx.$router)) {\r\n            return bindingCtx.$router;\r\n        }\r\n        bindingCtx = bindingCtx.$parentContext;\r\n    }\r\n    return Router$1.get(0);\r\n}\r\n\r\nko.components.register('ko-component-router', {\r\n    synchronous: true,\r\n    viewModel: {\r\n        createViewModel: function (params) { return new Router$1(unwrapParams(params)); }\r\n    },\r\n    template: \"<div data-bind=\\\"if: component\\\">\\n      <div class=\\\"ko-component-router-view\\\" data-bind=\\\"__ko_component_router__\\\"></div>\\n    </div>\"\r\n});\r\nko.bindingHandlers.__ko_component_router__ = {\r\n    init: function init(el, valueAccessor, allBindings, viewModel, bindingCtx) {\r\n        var $router = bindingCtx.$rawData;\r\n        ko.applyBindingsToNode(el, {\r\n            css: $router.component,\r\n            component: {\r\n                name: $router.component,\r\n                params: $router.ctx\r\n            }\r\n        }, bindingCtx.extend({\r\n            $router: $router\r\n        }));\r\n        return {\r\n            controlsDescendantBindings: true\r\n        };\r\n    }\r\n};\r\nfunction unwrapParams(params) {\r\n    function unwrapParam(p) {\r\n        if (ko.isObservable(params[p])) {\r\n            console.warn((\"\\n        [ko-component-router] `params.\" + p + \"` was passed in as an observable.\\n        It willbe unwrapped, but changes will NOT be observed.\\n    \"));\r\n            params[p] = ko.unwrap(params[p]);\r\n        }\r\n    }\r\n    \r\n    unwrapParam('routes');\r\n    unwrapParam('base');\r\n    unwrapParam('hashbang');\r\n    return params;\r\n}\r\n\r\nreturn Router$1;\r\n\r\n})));\r\n"]}